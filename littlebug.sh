#!/bin/bash
export lang=ja_jp.utf-8

<<<<<<< HEAD
: "çµ‚äº†æ™‚ã‚¯ãƒªãƒ³ãƒŠãƒƒãƒ—" && {
	# ä½œæ¥­ç”¨ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¾Œå§‹æœ«ç”¨é–¢æ•°ã¨ãƒˆãƒ©ãƒƒãƒ—è¨­å®š
	function cleanup_tmpdir() {
		:
	}
	trap cleanup_tmpdir INT
	trap cleanup_tmpdir EXIT
}

: â€åˆæœŸãƒã‚§ãƒƒã‚¯â€ && {
	#GUN AwkãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
	if [[ $(gawk --virsion > /dev/null 2>&1 ) =~ 'GNU Awk' ]] ; then
			echo "è­¦å‘Š: gunç‰ˆawk ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚gunç‰ˆawk ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚" >&2
			return 1
	fi

	declare tgtFile="$(basename "${1}")"   #å¼•æ•°ã§æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è±¡ã¨ã™ã‚‹
	if [[ "${tgtFile/ /}" = '' ]];then
		echo "ğŸ’©å¤‰æ›å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ãã ã•ã„"
		exit 1
	fi

	if [[ ! -e "${tgtFile}" ]]; then
		echo "ğŸ’© ${tgtFile}ãªã‚“ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã„ãªã„ã§ã™"
		exit 1
	fi

	convMode="${2}"  #'-t2h'ã§txtâ†’htmlã€'-h2t'ã§htmlâ†’txtã€ãã‚Œä»¥å¤–ã¯ä»Šã®æ‰€ã¯ã‚¨ãƒ©ãƒ¼

	if [[ "${convMode}" != '' ]] && [[ "${convMode}" != '-t' ]] ; then
		echo "ğŸ’© å¼•æ•°1ã¯ã€ç„¡ã—(txtâ†’html)ã‹ã€-t(htmlâ†’txt)ã§æŒ‡å®šã—ã¦ãã ã•ã„"
		exit 1
	fi
}

: "åˆæœŸå‡¦ç†" && {
	# æ–‡å­—ã‚³ãƒ¼ãƒ‰ç¢ºèªãƒ»å¤‰æ›ã€ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å®šç¾©
	chrset="$(file -i ${tgtFile})"

	SCRIPT_DIR=$(cd $(dirname $0); pwd)

	# å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€unknown-8bit(SJIS)ãªã‚‰UTF-8ã«å¤‰æ›ã™ã‚‹
	if [[ "${chrset##*charset=}" != 'utf-8' ]] ; then
		echo 'å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®charset(æ–‡å­—ã‚³ãƒ¼ãƒ‰)ãŒUTF-8ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å‡¦ç†ã¯ç¶šè¡Œã—ã¾ã™ãŒã€å¤‰æ›çµæœã‚’ä¿è¨¼ã—ã¾ã›ã‚“ã€‚'
		echo 'â€»  ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«æ—¥æœ¬èªæ–‡å­—ãŒä¸€ã¤ã‚‚å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã€æ­£ã—ãUTF-8ã§ã‚ã£ã¦ã‚‚ã“ã®è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™'
	fi
}

: "txtâ†’htmlå¤‰æ›å‡¦ç†" && {

	# if [[ "${convMode}" = '' ]]; then
	## txtâ†’html ############################################################################################

		: "AWKã‚³ãƒ¼ãƒ‰å®šç¾©" && {
			# littlebug.awkã®å†…å®¹ã‚’ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦å®šç¾©
			read -r -d '' AWK_CODE <<- 'AWK_EOF'
			#!/usr/bin/awk -f
			
			# ãƒ«ãƒ“ã‚¿ã‚°ã«ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸ã—ã¦ç½®æ›ã™ã‚‹é–¢æ•°
			# gawkæ‹¡å¼µã®match()ç¬¬ä¸‰å¼•æ•°ã‚’ä½¿ç”¨
			function apply_ruby_classes(text) {
				new_text = ""
				# ãƒ†ã‚­ã‚¹ãƒˆå†…ã«ãƒ«ãƒ“ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãªããªã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—
				while (match(text, /ï½œ([^ã€Š]+)ã€Š([^ã€‹]+)ã€‹/, m)) {
					# ãƒãƒƒãƒã—ãŸéƒ¨åˆ†ã‚ˆã‚Šå‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ 
					new_text = new_text substr(text, 1, RSTART - 1)
			
					parent = m[1]
					ruby = m[2]
			
					# ã‚¯ãƒ©ã‚¹ã®æ±ºå®š
					class = ""
					if (length(parent) == length(ruby)) {
						class = "ltlbg_ruby-mono"
					} else if (length(ruby) == 2 * length(parent)) {
						class = "ltlbg_ruby-same"
					} else if (length(ruby) > 2 * length(parent)) {
						class = "ltlbg_ruby-long"
					} else {
						class = "ltlbg_ruby-short"
					}
			
					# ç½®æ›å¾Œã®HTMLã‚’ç”Ÿæˆ
					replacement = "<ruby class=\"" class "\" data-" class "=\"" ruby "\">" parent "<rt>" ruby "</rt></ruby>"
					# æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã«ç½®æ›éƒ¨åˆ†ã‚’è¿½åŠ 
					new_text = new_text replacement
			
					# æœªå‡¦ç†ã®ãƒ†ã‚­ã‚¹ãƒˆéƒ¨åˆ†ã‚’æ›´æ–°
					text = substr(text, RSTART + RLENGTH)
				}
				# æ®‹ã‚Šã®ãƒ†ã‚­ã‚¹ãƒˆéƒ¨åˆ†ã‚’è¿½åŠ 
				new_text = new_text text
				return new_text
			}
			
			# åœç‚¹ï¼ˆå‚ç‚¹ï¼‰ã‚’æ–‡å­—ã”ã¨ã®ãƒ«ãƒ“ã«å¤‰æ›ã™ã‚‹é–¢æ•°
			function apply_emphasis_dots(text) {
				new_text = ""
				# ã€Šã€Š...ã€‹ã€‹ ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãªããªã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—
				while (match(text, /ã€Šã€Š([^ã€‹]+)ã€‹ã€‹/, m)) {
					# ãƒãƒƒãƒéƒ¨åˆ†ã‚ˆã‚Šå‰ã‚’ new_text ã«è¿½åŠ 
					new_text = new_text substr(text, 1, RSTART - 1)
			
					parent_text = m[1]
					
					replacement = ""
					
					# è¦ªæ–‡å­—ã‚’1æ–‡å­—ãšã¤ãƒ«ãƒ¼ãƒ—
					for (i = 1; i <= length(parent_text); i++) {
						char = substr(parent_text, i, 1)
						replacement = replacement "<ruby class=\"emphasis\">" char "<rt>ï¹…</rt></ruby>"
					}
					
					new_text = new_text replacement
					
					text = substr(text, RSTART + RLENGTH)
				}
				new_text = new_text text
				return new_text
			}
			
			BEGIN {
			state_p = "none"     # none, discript, bracket
			state_section = "none"     # none, section
			in_quote = 0       # 1 = ã€Œã€ã®å†…éƒ¨ã‚’å‡¦ç†ä¸­
			output_buffer = ""   # å‡ºåŠ›ãƒãƒƒãƒ•ã‚¡
			}
			
			{
			#############################################################################
			## åˆæœŸå‡¦ç†ã€è¡Œå…¨ä½“çš„ãªå‡¦ç†
			#############################################################################
			#ç©ºè¡Œã¯å‡ºåŠ›ã—ãªã„
			if ($0 ~ /^$/) { next; }
			
			#ç½®æ›å¾Œãƒ»å‡ºåŠ›ç”¨ã®æ–‡è¨€ã‚’å‰µå‡ºã—ã¤ã¤
			#åˆ¤å®šè‡ªä½“ã¯å…ƒã®è¡Œã®å½¢ã‚’ç”¨ã„ã‚‹ãŸã‚ã€$0ã¨lineã‚’åˆ¥ã«è¨­ã‘ã‚‹
			line = $0
			
			###########################################################
			# å‡¦ç†ä¸­ã«å•é¡Œã«ãªã‚‹ç‰¹æ®Šæ–‡å­—ã®ä¸€æ¬¡ç½®æ›(æœ€å¾Œã«å…ƒã«æˆ»ã™)
			# htmlã‚’æ„è­˜ã—ã¦æ—¢ã«æ–‡å­—å‚ç…§å‹ã§è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚‚å«ã‚€
			# ã‚¹ãƒ©ãƒƒã‚·ãƒ¥
			line = gensub(/&#047;|\//, "ï¼†ï¼ƒï¼ï¼”ï¼—", "g", line);
			# ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥
			line = gensub(/&#092;|\\/, "ï¼†ï¼ƒï¼ï¼™ï¼’", "g", line);
			# åŠè§’ã®>
			line = gensub(/&gt;|>/, "ï¼†ï½‡ï½”", "g", line);
			#åŠè§’ã®<
			line = gensub(/&lt;|</, "ï¼†ï½Œï½”", "g", line);
			# ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
			line = gensub(/&#39;|'/, "ï¼†ï¼ƒï¼“ï¼™", "g", line);
			# ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
			line = gensub(/&#quot;|\\"/, "ï¼†ï½‘ï½•ï½ï½”", "g", line);
			# æ®‹ã£ãŸã‚¢ãƒ³ãƒ‘ã‚µãƒ³ãƒ‰
			line = gensub(/&amp;|&/, "ï¼†ï½ï½ï½", "g", line);
			
			#ã‚´ãƒŸã‚¹ãƒšãƒ¼ã‚¹ã‚’æƒé™¤
			line = gensub(/[ ã€€]$/, "", "g", line);
			line = gensub(/[ ã€€]([ã€ã€ï¼‰ã€Ÿ])/, "\\1", "g", line);
			
			#è¨˜å·ç¨®é¡ã®çµ±ä¸€
			line = gensub(/[â™¡â™¥]/, "â¤", "g", line);
			line = gensub(/â˜†/, "â˜…", "g", line);
			line = gensub(/â–¡/, "â– ", "g", line);
			line = gensub(/[â™«â™¬]/, "â™ª", "g", line);
			line = gensub(/â€•+/, "â€•", "g", line);
			line = gensub(/ï¼ï¼/, "â€¼", "g", line);
			line = gensub(/ï¼ï¼Ÿ/, "!?", "g", line);
			line = gensub(/ï¼Ÿï¼/, "?!", "g", line);
			line = gensub(/ï¼Ÿï¼Ÿ/, "??", "g", line);
			line = gensub(/^(Â§+)[ ã€€]/, "\\1", "g", line);
			
			# é€£ç¶šã™ã‚‹æ„Ÿå˜†ç¬¦ãƒ»ç–‘å•ç¬¦ãƒ»è¨˜å·é¡ã®å¾Œã«å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒ¿å…¥ã—ã€
			# ãã‚Œã‚’<span class="ltlbg_wSp"></span>ã«ç½®æ›
			# å¯¾è±¡ ï¼!?ï¼Ÿâ¤ğŸ’ğŸ’•â™ªâ˜†â˜…ğŸ’¢
			line = gensub(/([!\?ï¼ï¼Ÿâ¤ğŸ’ğŸ’•â™ªâ˜†â˜…ğŸ’¢]+)ã€€*([^ã€ã€ï¼‰!\?ï¼ï¼Ÿâ¤ğŸ’ğŸ’•â™ªâ˜†â˜…ğŸ’¢])/, "\\1<span class=\"ltlbg_wSp\"></span>\\2", "g", line);
			
			#ä¸Šè¨˜ç‰¹æ®Šè¨˜å·(â¤,â˜…,â– ,â™ª,!!,!?,?!,??)ã‚’ã€<span class="ltlbg_wdfix"></span>ã‚¿ã‚°ã§æ‹¬ã‚‹
			line = gensub(/([â¤â˜…â– â™ª])/, "<span class=\"ltlbg_wdfix\">\\1</span>", "g", line);
			line = gensub("â€¼", "<span class=\"ltlbg_wdfix\">!!</span>", "g", line);
			line = gensub("!\\?", "<span class=\"ltlbg_wdfix\">!?</span>", "g", line);
			line = gensub("\\?!", "<span class=\"ltlbg_wdfix\">?!</span>", "g", line);
			line = gensub("\\?\\?", "<span class=\"ltlbg_wdfix\">??</span>", "g", line);
			
			
			#############################################################################
			## æ®µè½ç³»å‡¦ç†
			#############################################################################
			
			# section(ä¸­æ®µè½)###########################################################
			#è¡Œé ­ã«Â§ãŒç™»å ´ã™ã‚‹å ´åˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã‚¿ã‚°ã‚’ä»˜ä¸ã—ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚°ã‚’é–‹å§‹ã™ã‚‹ã€‚
			if ($0 ~ /^Â§+/) {
			
				#åˆå›ã®å ´åˆã€pã‚¿ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã¯é–‹å§‹ã•ã‚Œã¦ã„ãªã„ã®ã§é–‰ã˜ãªã„
				#åˆå›ä»¥å¤–ã§ã¯ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¢ƒç•Œã§pã‚¿ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å¿…ãšé–‰ã˜ã‚‹
				if (state_p != "none") {
					output_buffer = output_buffer "  </div>" ORS
					state_p = "none"
				}
				#åˆå›ã®å ´åˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹(ã‚»ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’é–‹å§‹ã™ã‚‹)
				#åˆå›ä»¥å¤–ã§ã¯ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‰ã˜ã¦ã‹ã‚‰é–‹ãç›´ã™
				if (state_section != "none") {
				output_buffer = output_buffer "</section>" ORS
				}
				output_buffer = output_buffer "<section class=\"ltlbg_section\">" ORS
				state_section = "section"
			
				# Â§ã®è¡Œè‡ªä½“ã«ã‚‚ãƒ«ãƒ“ãªã©ã®ç½®æ›ã‚’é©ç”¨ã—ãŸã„å ´åˆã¯ã“ã“ã«è¨˜è¿°
				line = apply_ruby_classes(line)
				line = apply_emphasis_dots(line)
				
				line = gensub(/(Â§+.*)/, "  <h2 class=\"ltlbg_section_name\">\\1</h2>", "g", line);
			
				output_buffer = output_buffer line ORS
				next
			}
			
			# div(ä¸­æ®µè½)  ################################################################
			# å½“å½¢å¼ã§ã¯ã€Œåœ°ã®æ–‡ã®å¡Šã€ã¨ã€Œã‚»ãƒªãƒ•ã®å¡Šã€ã‚’åˆ†ã‘ã¦ç®¡ç†ã—ã€ãã®å¡Šã‚’æ„å‘³æ®µè½ã®ä¸€ç¨®ã¨ã—ã¦divã§æ‹¬ã‚‹ã€‚
			# åœ°ã®æ–‡ã®å¡Šâ€¦â€¦discript-groupã‚¯ãƒ©ã‚¹
			# ã‚»ãƒªãƒ•ã®å¡Šâ€¦â€¦bracket-groupã‚¯ãƒ©ã‚¹
			# ã“ã®æ„å‘³æ®µè½ã‚’ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ã©ã†è½ã¨ã—è¾¼ã‚€ã‹(ä¾‹ãˆã°åœ°ã®æ–‡ã¨ã‚»ãƒªãƒ•ã®é–“ã«ã¯ç©ºè¡Œã‚’æŒŸã‚€å½¢å¼ãªã©)ã¯ã€ã‚¹ã‚¿ã‚¤ãƒ«(css)ã«ã‚ˆã£ã¦æ±ºå®šã™ã‚‹ã€‚
			
			# ç¾åœ¨ã®è¡Œã«é–‹ãæ‹¬å¼§é¡ãŒå«ã¾ã‚Œã‚‹ã‹ï¼ˆé–‹å§‹åˆ¤å®šï¼‰
			# å«ã¾ã‚Œã¦ã„ã‚Œã°ã€ä»¥é™ã‚’ã‚¯ã‚ªãƒ¼ãƒˆçŠ¶æ…‹ã¨ã—ã€æ¬¡ã«è¡Œæœ«é–‰ã˜æ‹¬å¼§é¡ãŒç¾ã‚Œã‚‹ã¾ã§ã‚¯ã‚ªãƒ¼ãƒˆä¸­ã‚’ç¶­æŒã™ã‚‹
			if ($0 ~ /^[ã€Œã€ï¼ˆ]/) { in_quote = 1}
			
			# åˆ¤å®šï¼šç¾åœ¨ã€ã‚¯ã‚ªãƒ¼ãƒˆçŠ¶æ…‹ãŒç¶™ç¶šä¸­ã§ã‚ã‚‹ã‹ã€ã‚‚ã—ãã¯è¡Œé ­é–‹ãæ‹¬å¼§é¡ã‹
			# ã‚‚ã—ãã†ã§ã‚ã‚Œã°ã€pã‚¿ã‚°ã®ã‚¯ãƒ©ã‚¹ã‚’bracketã«ã™ã‚‹ã€‚
			# ã“ã‚Œã«è©²å½“ã—ãªã„å ´åˆã¯ã‚¯ãƒ©ã‚¹ã¯discriptã¨ãªã‚‹
			if ( in_quote == 1 || $0 ~ /^[ã€Œã€ï¼ˆ]/) {
				current_type = "ltlng_bracket-group"
			} else {
				current_type = "ltlng_discript-group"
			}
			
			# çŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸï¼ˆã¾ãŸã¯æœ€åˆã®è¡Œï¼‰å ´åˆã®ã‚¿ã‚°æŒ¿å…¥
			if (state_p != current_type) {
				if (state_p != "none") { output_buffer = output_buffer "  </div>" ORS }
				output_buffer = output_buffer "  <div class=\"" current_type "\">" ORS
				state_p = current_type
			}
			
			# p(å°æ®µè½)###########################################################
			# è¡Œé ­ãŒå…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã®è¡Œã¯ã€Œåœ°ã®æ–‡ã®å½¢å¼æ®µè½ã€ã¨ã™ã‚‹ã€‚
			# è¡Œé ­ãŒé–‹ãæ‹¬å¼§é¡ã®è¡Œã¯ã‚»ãƒªãƒ•ã ãŒã€ã‚»ãƒªãƒ•ã®è¡Œã‚‚å½¢å¼æ®µè½ã¨ã—ã¦æ‰±ã†ã€‚
			# å½“å½¢å¼ã§ã¯ã€ã‚»ãƒªãƒ•å†…ã«æ›´ã«å½¢å¼æ®µè½ã‚’å«ã‚€ã“ã¨ã‚’è¨±å®¹ã™ã‚‹ã€‚
			# ã‚»ãƒªãƒ•å†…å½¢å¼æ®µè½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ã‚»ãƒªãƒ•æ®µè½ã¯ä»¥ä¸‹ã®ï¼”ã¤ã«åˆ†é¡ã™ã‚‹ã€‚
			# ï¼‘ï¼é–‹ãæ‹¬å¼§ã¨é–‰ã˜æ‹¬å¼§ã®ä¸¡æ–¹ã‚’å«ã‚€è¡Œ(ä¸€èˆ¬çš„ãªã‚»ãƒªãƒ•è¡Œ)
			# ï¼’ï¼é–‹ãæ‹¬å¼§ã®ã¿(ã‚»ãƒªãƒ•å†…å½¢å¼æ®µè½ã«ã¤ãªãŒã‚‹è¡Œ)
			# ï¼“ï¼é–‰ã˜æ‹¬å¼§ã®ã¿ (ã‚»ãƒªãƒ•å†…å½¢å¼æ®µè½ã‹ã‚‰æˆ»ã‚‹è¡Œ)
			# ï¼”ï¼å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã§å§‹ã¾ã‚‹è¡Œ(åœ°ã®æ–‡å½¢å¼æ®µè½ã¨åŒã˜æ‰±ã„ã€‚ã‚»ãƒªãƒ•å†…ã§ã‚ã‚‹ã‹å¦ã‹ã‚’å•ã‚ãªã„)
			# ãã‚Œãã‚Œã«å¯¾å¿œã™ã‚‹pã‚¿ã‚°ã‚’ç”Ÿæˆã™ã‚‹ã€‚
			line = gensub(/^([ã€Œã€ï¼ˆ])([^ã€ã€ï¼‰]+)([ã€ã€ï¼‰])$/, "    <p class=\"ltlbg_bracket\" data-p_header=\"\\1\" data-p_footer=\"\\3\">\\2</p><!--bracket-->", "g", line); #ä¸¡æ–¹
			line = gensub(/^([ã€Œã€ï¼ˆ])([^ã€ã€ï¼‰]+)$/, "    <p class=\"ltlbg_bracket\" data-p_header=\"\\1\" data-p_footer=\"\">\\2</p><!--bracket-->", "g", line); #é–‹æ‹¬å¼§ã®ã¿
			line = gensub(/^([^ã€Œã€ï¼ˆ]+)([ã€ã€ï¼‰])$/, "    <p class=\"ltlbg_bracket\"ã€€data-p_footer=\"\\2\">\\1</p><!--bracket-->", "g", line); #é–‰ã˜æ‹¬å¼§ã®ã¿
			line = gensub(/^ã€€(.+)$/, "    <p class=\"ltlbg_desciption\" data-p_header=\"ã€¼\">\\1</p><!--descript-->", "g", line); #åœ°ã®æ–‡(æ‹¬å¼§é¡ã‚°ãƒ«ãƒ¼ãƒ—ã®å†…éƒ¨å«ã‚€)
			
			#############################################################################
			## é€šå¸¸ã®å¤‰æ›
			#############################################################################
			# å¥èª­ç‚¹ãƒ»è¨˜å·é¡ã®spanã‚¿ã‚°åŒ–###########################################################  
			#ã‚¿ã‚°ã§æ‹¬ã‚‹ã‚¿ã‚¤ãƒ—ã®ä¿®é£¾_1æ–‡å­—
			line = gensub("[^\"]ã€€[^\"]", "<span class=\"ltlbg_wSp\"></span>", "g", line); # å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
			line = gensub(/â€•/, "<span class=\"ltlbg_wSize\">â€•</span>", "g", line); #å…¨è§’ãƒ€ãƒƒã‚·ãƒ¥ã¯å¸¸ã«ãƒ¯ã‚¤ãƒ‰ã‚¿ã‚°ã‚’é©ç”¨
			line = gensub(/\[-(.)-\]/, "<span class=\"ltlbg_wdfix\">\\1</span>", "g", line); #å¼·åˆ¶1æ–‡å­—å¹…ã‚¿ã‚°
			line = gensub(/\[\^(.)\^\]/, "<span class=\"ltlbg_rotate\">\\1</span>", "g", line); #å›è»¢ã‚¿ã‚°
			line = gensub(/\[l\[(.)\]r\]/, "<span class=\"ltlbg_forcedGouji1/2\">\\1</span>", "g", line); #å¼·åˆ¶åˆå­—1/2ã‚¿ã‚°
			line = gensub(/[ï¼›;]/, "<span class=\"ltlbg_semicolon\">ï¼›</span>", "g", line); #åŠè§’ã‚»ãƒŸã‚³ãƒ­ãƒ³ã¯å…¨ã¦å…¨è§’ã«ä¿®æ­£
			line = gensub(/[ï¼š:]/, "<span class=\"ltlbg_colon\">ï¼š</span>", "g", line); #åŠè§’ã‚³ãƒ­ãƒ³ã¯å…¨ã¦å…¨è§’ã«ä¿®æ­£
			
			#   #ã‚¿ã‚°ã§æ‹¬ã‚‹ã‚¿ã‚¤ãƒ—ã®ä¿®é£¾_è¤‡æ•°æ–‡å­—
			line = gensub(/~..~/,"<span class=\"ltlbg_tcy\">//1</span>", "g",line) #ç¸¦ä¸­æ¨ª
			line = gensub(/\*\*\([^\*]+\)\*\*/, "<span class=\"ltlbg_bold\">\\1</span>", "g", line); #å¤ªå­—
			line = gensub(/\[\^(.)\^\]/, "<span class=\"ltlbg_rotate\">\\1</span>", "g", line); #å›è»¢
	
			# ã‚¿ã‚°ã«ç½®æ›ã™ã‚‹ã‚¿ã‚¤ãƒ—ã®å¤‰æ›
			# ã‚¿ã‚°ã‚’æŒ¿å…¥ã™ã‚‹ã ã‘ã§ã€æ”¹ãƒšãƒ¼ã‚¸ã®å®Ÿè£…ã¯ã‚¹ã‚¿ã‚¤ãƒ«ã«ã‚ˆã‚‹
			line = gensub(/ã‚›/, "<span class=\"ltlbg_dakuten\"></span>", "g", line); #ã‚¹ã‚±ãƒ™æ¿éŸ³
			line = gensub(/ã‚œ/, "<span class=\"ltlbg_handakuten\"></span>", "g", line); #ã‚­ãƒã‚¬ã‚¤åŠæ¿éŸ³
			line = gensub(/\[newpage\]/, "<br class=\"ltlbg_newpage\">", "g", line); # æ”¹ãƒšãƒ¼ã‚¸
			line = gensub(/---/, "<span class=\"ltlbg_hr\"></span>", "g", line); # æ°´å¹³ç·š
			line = gensub(/ï¼ï¼¼|ã€±/, "<span class=\"ltlbg_odori1\"></span><span class=\"ltlbg_odori2\"></span>", "g", line); #è¸Šã‚Šå­—ã€‚
			
			###########################################################
			# ãƒ«ãƒ“ãƒ»åœç‚¹â€¦â€¦ä¸Šéƒ¨ã®é–¢æ•°ã§å®Ÿè£…
			###########################################################
			line = apply_ruby_classes(line)
			line = apply_emphasis_dots(line)
			
			
			#############################################################################
			## è¡Œæœ«å‡¦ç†
			#############################################################################
			## ç‰¹æ®Šæ–‡å­—ã®å¾©æ—§
			line = gensub(/ï¼†ï½ï½ï½/, "\\&amp;", "g", line);
			line = gensub(/ï¼†ï½Œï½”/, "\\&lt;", "g", line);
			line = gensub(/ï¼†ï½‡ï½”/, "\\&gt;", "g", line);
			line = gensub(/ï¼†ï¼ƒï¼“ï¼™/, "\\&#39;", "g", line);
			line = gensub(/ï¼†ï½‘ï½•ï½ï½”/, "\\&quot;", "g", line);
			line = gensub(/ï¼†ï¼ƒï¼ï¼”ï¼—/, "\\&#047;", "g", line);
			line = gensub(/ï¼†ï¼ƒï¼ï¼™ï¼’/, "\\&#092;", "g", line);
			
			#å¿…è¦ãŒã‚ã£ã¦ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«ä»£ã‚ã‚Šã«ä½¿ç”¨ã—ã¦ã„ãŸä»¥ä¸‹ã®ç‰¹æ®Šæ–‡å­—ã‚’å…ƒã«æˆ»ã™
			line = gensub(/ã€¿/, " ", "g", line);
			line = gensub(/ã€¼/, "ã€€", "g", line);
			
			# è¡Œæœ« ãŒã€ ã‹ã©ã†ã‹ï¼ˆçµ‚äº†åˆ¤å®šï¼‰
			# è¡Œæœ«ãŒã€ã§ã‚ã‚Œã°ã€ç¾åœ¨ç¶™ç¶šä¸­ã®ã‚¯ã‚ªãƒ¼ãƒˆçŠ¶æ…‹ã‚’è§£é™¤ã™ã‚‹ã€‚
			if ($0 ~ /[ã€ã€ï¼‰]$/) { in_quote = 0 }
			
			# è¡Œã®å‡ºåŠ›ï¼ˆãƒ¡ãƒ¢ãƒªã«æºœã‚è¾¼ã‚€ï¼‰
			output_buffer = output_buffer line ORS
			
			}
			
			END {
			#ä¸€åº¦ã‚‚pã‚¿ã‚°ãŒç™»å ´ã—ã¦ã„ãªã„å ´åˆã€é–‰ã˜ã‚‹å¿…è¦ãŒãªã„(ã»ã¼ã‚ã‚Šå¾—ãªã„ãŒ)
			if (state_p != "none") { output_buffer = output_buffer "  </div>" ORS }
			
			#ä¸€åº¦ã‚‚sectionã‚¿ã‚°ãŒç™»å ´ã—ã¦ã„ãªã„å ´åˆã€é–‰ã˜ã‚‹å¿…è¦ãŒãªã„(å‰²ã¨ã‚ã‚Šå¾—ã‚‹)
			if (state_section != "none") { output_buffer = output_buffer "</section>" ORS }
			
			##########################################################################################
			# htmlã«ãªã‚‹ã‚ˆã†ã«å…ˆé ­ã¨æœ«å°¾ã«å¿…è¦ãªã‚¿ã‚°ã‚’ä»˜ä¸ã™ã‚‹ã€‚
			# ã¾ãŸlittlebugXXX.cssèª­ã¿è¾¼ã‚€ã‚ˆã†è¿½è¨˜ã™ã‚‹
			##########################################################################################
			header =        "<html>" ORS
			header = header "  <head>" ORS
			header = header "    <link rel=\"stylesheet\" href=\"../css/littlebugI.css\">" ORS
			header = header "    <!--<link rel=\"stylesheet\" href=\"../css/littlebugV.css\">-->" ORS
			header = header "    <link rel=\"stylesheet\" href=\"../css/littlebugH.css\">" ORS
			header = header "    <link rel=\"stylesheet\" href=\"../css/littlebugU.css\">" ORS
			header = header "  </head>" ORS
			header = header "  <body>" ORS
			header = header "<div class=\"ltlbg_container\">" ORS
			header = header "<!--æ–‡ç« å†…å®¹ã“ã“ã‹ã‚‰-->" ORS
			
			footer =        "<!--æ–‡ç« å†…å®¹ã“ã“ã¾ã§-->" ORS
			footer = footer "</div><!--ltlbg_container-->" ORS
			footer = footer "</body>" ORS
			footer = footer "</html>" ORS
			
			# ãƒ¡ãƒ¢ãƒªã«æºœã‚è¾¼ã‚“ã å…¨ã¦ã®å‡ºåŠ›ã‚’ä¸€åº¦ã«å‡ºåŠ›
			printf "%s", header output_buffer footer
			}
			AWK_EOF
		}

		destFile="${tgtFile/'.txt'/'_tagged.html'}" #å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã™ã‚‹
		printf '' > "${destFile}"

		: "è­¦å‘Šè¡¨ç¤º" && {
			##è­¦å‘Šè¡¨ç¤º####################################################################
			# å¤‰æ›ä¸èƒ½ãªã‚±ãƒ¼ã‚¹ã‚’äºˆã‚æŠ½å‡ºã™ã‚‹ã€‚
			# å‡¦ç†ã¯ä¸­æ–­ã›ãšæœ€å¾Œã¾ã§è¡Œã†ãŒã€è­¦å‘Šè¡¨ç¤ºã‚’è¡Œã†ã€‚
			# ãŠãã‚‰ãå¤‰æ›å‡¦ç†ã¯æˆåŠŸã—ãªã„ã€‚
			##############################################################################
			# ãƒ«ãƒ“æŒ‡å®šã«å‚ç‚¹ã®åŒæ™‚æŒ‡å®š
			# ï½œã€Šã€‹ã®å…¨ä½“ã‹æ¯å­—éƒ¨åˆ†ã‹ã®ã©ã¡ã‚‰ã‹ã«ã€ã€Šã€Šã€‹ã€‹æŒ‡å®šãŒå…¥ã‚Œå­ã•ã‚Œã¦ã„ã‚‹â€»ãƒ«ãƒ“æ–‡å­—éƒ¨åˆ†ã¸ã®ç‰¹æ®ŠæŒ‡å®šã¯å¾Œç¶šã§ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹
			grep -E -o -n 'ï½œ[^ã€Š]*ã€Šã€Š[^ã€‹]+ã€‹ã€‹ã€Š[^ã€‹]+ã€‹|ã€Šã€Š[^ï½œ]*ï½œ[^ã€Š]+ã€Š[^ã€‹]+ã€‹[^ã€‹]*ã€‹ã€‹' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“ã¨å‚ç‚¹ãŒåŒæ™‚ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›çµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			#2æ–‡å­—ä»¥ä¸Šã«å›è»¢æŒ‡å®š
			grep -E -o -n '\[\^[^\^]{2,}\^\]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§2æ–‡å­—ä»¥ä¸Šã®ç¯„å›²ã«å›è»¢ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›çµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			#ãƒ«ãƒ“å…¨ä½“ã¸ã®å›è»¢æŒ‡å®šâ€»æ¯å­—ã®ã¿ã‚ã‚‹ã„ã¯ãƒ«ãƒ“æ–‡å­—ã®ã¿ã¯è¨±å®¹ã™ã‚‹
			grep -E -o -n '\[\^[^ï½œ]*ï½œ[^ã€Š]*ã€Šã€Š[^ã€‹]+ã€‹ã€‹[^\^]*\^\]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“ã¨å›è»¢ãŒåŒæ™‚ã«æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›çµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			#ãƒ«ãƒ“æŒ‡å®šå…¨ä½“ã¸ã®ç¸¦ä¸­æ¨ªâ€»æ¯å­—ã®ã¿ã‚ã‚‹ã„ã¯ãƒ«ãƒ“æ–‡å­—ã®ã¿ã¯è¨±å®¹ã™ã‚‹
			grep -E -o -n '\^[^ï½œ]*ï½œ[^ã€Š]*ã€Šã€Š[^ã€‹]+ã€‹ã€‹[^\^]*\^' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“æŒ‡å®šå…¨ä½“ã¸ã®ç¸¦ä¸­æ¨ªãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›çµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# ç¸¦ä¸­æ¨ªã®ä¸­ã«åŠè§’è‹±æ•°è¨˜å·ä»¥å¤–(æ–‡å­—ã‚³ãƒ¼ãƒ‰ä¸Šã€ŒåŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã€ã€œã€Œ~ã€ã®é ˜åŸŸ)ãŒå«ã¾ã‚Œã¦ã„ã‚‹
			# ãŸã ã—ã€ç¸¦ä¸­æ¨ªå…¨ä½“ã¸ã®å¤ªå­—ã¨å‚ç‚¹ã¯ã¯è¨±å®¹ã™ã‚‹ãŸã‚ã€ã€Šã€‹*ã‚‚ã“ã‚Œã‚‰ã«å«ã‚ãªã„ã€‚
			grep -E -o -n '\^[^\^]*[^ -~ã€Šã€‹]+[^\^]*\^' "${tgtFile}" >"${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ç¸¦ä¸­æ¨ªã®ä¸­ã«åŠè§’è‹±æ•°æ–‡å­—ä»¥å¤–ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# ç¸¦ä¸­æ¨ªæŒ‡å®šã®ä¸€éƒ¨ã«å¤ªå­—æŒ‡å®š
			# ç¸¦ä¸­æ¨ªæŒ‡å®š^æ–‡å­—^ã®ä¸­ã«ã€**ã¨**ã§æ‹¬ã‚‰ã‚Œã¦ã„ãªã„æ–‡å­—ãŒ1æ–‡å­—ä»¥ä¸Šã‚ã‚‹
			grep -E -o -n '\^[^\*]+\*\*[^\*]+\*\*\^|\^\*\*[^\*]+\*\*[^\*]+\^' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ç¸¦ä¸­æ¨ªã®ä¸€éƒ¨ã«ã ã‘å¤ªå­—ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›çµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# 4æ–‡å­—ä»¥ä¸Šã®ç¸¦ä¸­æ¨ª()
			# ãŸã ã—ã€ç¸¦ä¸­æ¨ªå…¨ä½“ã¸ã®å¤ªå­—ã¨å‚ç‚¹ã¯ã¯è¨±å®¹ã™ã‚‹ãŸã‚ã€ã€Šã€‹*ã‚‚ã“ã‚Œã‚‰ã«å«ã‚ãªã„ã€‚
			grep -E -o -n '\^(\*\*)*[^\*ã€Šã€‹]{4,}(\*\*)*\^' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§4æ¡ä»¥ä¸Šã®ç¸¦ä¸­æ¨ªãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# ç¸¦ä¸­æ¨ªæŒ‡å®šã®ä¸€éƒ¨ã«ã®ã¿å‚ç‚¹æŒ‡å®š
			grep -E -o -n '\^[^ã€Š]+ã€Šã€Š[^ã€‹]+ã€‹ã€‹\^|\^ã€Šã€Š[^ã€‹]+ã€‹ã€‹[^ã€‹]+\^' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ç¸¦ä¸­æ¨ªã®ä¸€éƒ¨ã«ã ã‘å‚ç‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# ãƒ«ãƒ“æŒ‡å®šå…¨ä½“ã«å›è»¢æŒ‡å®š
			grep -E -o -n '\[\^ï½œ[^ã€Š]+ã€Š[^ã€‹]+ã€‹\^\]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“æŒ‡å®šã®å…¨ä½“ã«å›è»¢ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# å¼·åˆ¶åˆå­—ã®æŒ‡å®šãŒ2æ–‡å­—ã§ã¯ãªã„
			# 1æ–‡å­—ã‹ã€3æ–‡å­—ä»¥ä¸Šã¯é§„ç›®
			grep -E -o -n '\[l\[[^\]\]r\]|\[l\[[^\]{3}\]r\]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§å¼·åˆ¶åˆå­—ã«ã¯2æ–‡å­—ã ã‘ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# ã‚¢ã¸æ¿ç‚¹ã«å›è»¢æŒ‡å®š
			grep -E -o -n '\[\^.ã‚›\^\]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§å¼·åˆ¶æ¿ç‚¹ã«å›è»¢ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# ãƒ«ãƒ“æ–‡å­—ã«ç‰¹æ®ŠæŒ‡å®š
			## ãƒ«ãƒ“æ–‡å­—ã«ãƒ«ãƒ“
			grep -E -o -n 'ï½œ[^ã€Š]+ã€Š[^ï½œ]*ï½œ[^ã€Š]+ã€Š[^ã€‹]+ã€‹[^ã€‹]*ã€‹' "${tgtFile}" > "${destFile}"
			## ãƒ«ãƒ“æ–‡å­—ã«å¤ªå­—
			grep -E -o -n 'ï½œ[^ã€Š]+ã€Š[^ã€Š]*ã€Šã€Š[^ã€‹]+ã€‹ã€‹[^ã€‹]*ã€‹' "${tgtFile}" >> "${destFile}"
			## ãƒ«ãƒ“æ–‡å­—ã«å›è»¢
			grep -E -o -n 'ï½œ[^ã€Š]+ã€Š[^\[]*\[\^\[^\^]\^\][^ã€‹]*ã€‹' "${tgtFile}" >> "${destFile}"
			## ãƒ«ãƒ“æ–‡å­—ã«åˆå­—
			grep -E -o -n 'ï½œ[^ã€Š]+ã€Š[^[]*[l[[^]]{2}]r][^ã€‹]*ã€‹' "${tgtFile}" >> "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“æ–‡å­—ã«ä¿®é£¾ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
			fi
			# ä¸è¦ãªã‚¹ãƒšãƒ¼ã‚¹(æ”¹è¡Œç›´å‰ã®ã‚¹ãƒšãƒ¼ã‚¹ã€é–‰ã˜æ‹¬å¼§ç›´å‰ã®ã‚¹ãƒšãƒ¼ã‚¹)
			grep -E -o -n '[ ã€€]$|[ ã€€]([ã€ã€ï¼‰ã€Ÿ])|^(Â§+)[ ã€€]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã«ä¸è¦ãªã‚¹ãƒšãƒ¼ã‚¹(æ”¹è¡Œç›´å‰ã®ã‚¹ãƒšãƒ¼ã‚¹ã€é–‰ã˜æ‹¬å¼§ç›´å‰ã®ã‚¹ãƒšãƒ¼ã‚¹ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¨˜å·ç›´å¾Œã®ã‚¹ãƒšãƒ¼ã‚¹)ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚'
				echo 'å†…éƒ¨çš„ã«é™¤å»ã—ã¦å¤‰æ›ã‚’å®Ÿæ–½ã—ã¾ã™ï¼ˆå…ƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ã—ã¾ã›ã‚“ãŒã€ä¿®æ­£ãŒå¿…è¦ãªç®‡æ‰€ã§ã™ï¼‰ã€‚'
			fi
			#çµ„ç‰ˆæ™‚ã«ç½®æ›ã•ã‚Œã‚‹è¨˜å·é¡
			##è¡¨è¨˜ã‚†ã‚Œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹è¨˜å·ã®çµ±ä¸€
			grep -E -o -n '[â™¡â™¥â˜†â–¡â™«â™¬]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã«å«ã¾ã‚Œã‚‹è¨˜å·ã¯å¤‰æ›å¾Œã€åˆ¥ã®è¨˜å·ã«ç½®æ›ã•ã‚Œã¾ã™ã€‚ï¼ˆå…ƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ã—ã¾ã›ã‚“ï¼‰'
			fi
			##çµ„ç‰ˆæ™‚ã«ç½®æ›ã•ã‚Œã‚‹é€£ç¶šã€Œâ€•ã€
			grep -E -o -n 'â€•{2,}' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã«å«ã¾ã‚Œã‚‹ã€é€£ç¶šã™ã‚‹ã€Œâ€•ã€ã¯ã€å€ã‚µã‚¤ã‚ºã®ä¸€ã¤ã®ã€Œâ€•ã€ã¸å¤‰æ›ã•ã‚Œã¾ã™(å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ã—ã¾ã›ã‚“)'
			fi
			##ï¼ï¼Ÿã®ãƒšã‚¢
			grep -E -o -n 'ï¼ï¼|ï¼ï¼Ÿ|ï¼Ÿï¼|ï¼Ÿï¼Ÿ' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã«å«ã¾ã‚Œã‚‹ã€ï¼!ã€ï¼ï¼Ÿãªã©ã®ãƒšã‚¢ã¯å¤‰æ›å¾Œã€ï¼‘æ–‡å­—å¹…ã«åã¾ã‚‹ã‚ˆã†ã«åŠè§’ã®ãƒšã‚¢ã«å¤‰æ›ã•ã‚Œã¾ã™(å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ã—ã¾ã›ã‚“)'
			fi
			grep -E -o -n '^(Â§+)[ ã€€]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã«å«ã¾ã‚Œã‚‹ã€ï¼!ã€ï¼ï¼Ÿãªã©ã®ãƒšã‚¢ã¯å¤‰æ›å¾Œã€ï¼‘æ–‡å­—å¹…ã«åã¾ã‚‹ã‚ˆã†ã«åŠè§’ã®ãƒšã‚¢ã«å¤‰æ›ã•ã‚Œã¾ã™(å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ã—ã¾ã›ã‚“)'
			fi
			grep -E -o -n '^$' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘ã«å«ã¾ã‚Œã‚‹ç©ºè¡Œã¯ã€å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã®è¨˜è¿°ã«é–¢ã‚ã‚‰ãšã€å¤‰æ›è¦å‰‡ã«å‰‡ã£ã¦å‰Šé™¤ã‚ã‚‹ã„ã¯è¿½åŠ ã•ã‚Œã¾ã™(å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ã—ã¾ã›ã‚“)'
			fi
			# è¨˜å·é¡ã®ç›´å¾Œã®ã‚¹ãƒšãƒ¼ã‚¹
			grep -E -o -n '[!\?ï¼ï¼Ÿâ¤ğŸ’ğŸ’•â™ªâ˜†â˜…ğŸ’¢]+ã€€*[^ã€ã€ï¼‰!\?ï¼ï¼Ÿâ¤ğŸ’ğŸ’•â™ªâ˜†â˜…ğŸ’¢]' "${tgtFile}" > "${destFile}"
			if [[ -s "${destFile}" ]]; then 
				cat "${destFile}"
				echo 'ğŸ¤” â†‘è¨˜å·é¡ã®ç›´å¾Œã«ã€ãã‚ŒãŒé€£ç¶šã™ã‚‹ã‹è¡Œæœ«ãƒ»æ‹¬å¼§å†…æœ«å°¾ã§ãªã„é™ã‚Šã€ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒ¿å…¥ã—ã¾ã™(å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ã—ã¾ã›ã‚“)'
			fi

		}

		: "å¤‰æ›å®Ÿæ–½" && {
			#AWKã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œï¼ˆãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§å®šç¾©ã•ã‚ŒãŸAWK_CODEã‚’ä½¿ç”¨ï¼‰
			gawk "$AWK_CODE" "${tgtFile}" > "${destFile}"
		}

		echo "âœ¨ "${destFile}"ã‚’å‡ºåŠ›ã—ã¾ã—ãŸ[htmlåŒ–]"

	# fi

}

# elif [[ "${convMode}" = '-h2t' ]]; then
#   ## htmlâ†’txt ############################################################################################

#   destFile=${tgtFile_AfterCD/".html"/"_removed.txt"} #å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã™ã‚‹
#   touch ${destFile}                          #å‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ

#   ## littlebugXX.cssã®èª­ã¿è¾¼ã¿ã‚’é™¤å»ã™ã‚‹
#   cat ${tgtFile_AfterCD} \
#   | sed -z 's/<link rel=\"stylesheet\" href=\".\+littlebug.\+css\">//' \
#   | sed -z 's/<link rel=\"preconnect\" href=\"https:\/\/fonts\.googleapis\.com\">\n//' \
#   | sed -z 's/<link rel=\"preconnect\" href=\"https:\/\/fonts\.gstatic\.com\" crossorigin>\n//' \
#   | sed -z 's/<link href=\"https:\/\/fonts\.googleapis\.com\/css2\?family=Noto\+Serif\+JP:wght\@300\&display=swap\" rel=\"stylesheet">\n//' \
#   >tmp1_ltlbgtmp
	
#   ############################################################################################
#   #å…¥ã‚Œå­æ§‹é€ ã«ãªã‚Šã†ã‚‹ã‚¿ã‚°ã®å¾©æ—§1ã€‚å¤–å´ã€‚ä¿®é£¾ã¯æœ€å¤§3ãªã®ã§ã€å¾©æ—§å‡¦ç†ã‚’3å›åå¾©ã™ã‚‹
#   ############################################################################################
#   for i in $(seq 0 2); do
#     ############################################################################################
#     #å…¥ã‚Œå­æ§‹é€ ã«ãªã‚Šã†ã‚‹ã‚¿ã‚°ã®å¾©æ—§2ã€‚å†…å´ã€‚ä¿®é£¾ã¯æœ€å¤§3ãªã®ã§ã€å¾©æ—§å‡¦ç†ã‚’3å›åå¾©ã™ã‚‹
#     ############################################################################################
#     for i in $(seq 0 2); do
#       ## ç« åŒºåˆ‡ã‚Šã‚’[chapter:XXXX]ã«
#       ### é–‰ã˜ã‚¿ã‚°</section><!--ltlbg_section-->ã‚’é™¤å»
#       ### <section class="ltlbg_section" id="XXX">ã‚’[chapter:]ã¸
#       cat tmp1_ltlbgtmp \
#       | sed -e 's/<\/section><!--ltlbg_section-->//g' \
#       | sed -e 's/<section class="ltlbg_section">/[chapter]/g' \
#       | sed -e 's/<section class="ltlbg_section" id="\([^"]\+\)">/[chapter:\1]/g' \
#       | sed -e 's/\[chapter:\]/\[chapter\]/g' \
#       >tmp2_ltlbgtmp

#       ## é–‰ã˜pã‚¿ã‚°ã‚’æ¶ˆã—ã€pã‚¿ã‚°ã‚’å…¨è§’ç©ºç™½ã¸ç½®æ›ã™ã‚‹
#       ## å…¨è§’ç©ºç™½ç›´å¾Œã®æ”¹è¡Œã¯å‰Šé™¤ã™ã‚‹(å…ƒã®pã‚¿ã‚°ãŒç›´å¾Œã«æ”¹è¡Œã—ã¦ã„ã‚‹ãŸã‚)
#       cat tmp2_ltlbgtmp \
#       | sed -e 's/<\/p><!--ltlbg_p-->//g' \
#       | sed -e 's/<p class="ltlbg_p">/<span class="ltlbg_wSp"><\/span>/g' \
#       | sed -z 's/<span class="ltlbg_wSp"><\/span>\n<span class="ltlbg_talk">/\n<span class="ltlbg_talk">/g' \
#       >tmp1_ltlbgtmp

#       ## æ‹¬å¼§é¡ã‚’å¾©æ—§
#       cat tmp1_ltlbgtmp \
#       | sed -e 's/<\/span><!--ltlbg_talk-->/ã€/g' \
#       | sed -e 's/<\/span><!--ltlbg_talk2-->/ã€/g' \
#       | sed -e 's/<\/span><!--ltlbg_think-->/ï¼‰/g' \
#       | sed -e 's/<\/span><!--ltlbg_wquote-->/ã€Ÿ/g' \
#       | sed -e 's/<\/span><!--ltlbg_dash-->//g' \
#       | sed -e 's/<\/span><!--ltlbg_citation-->//g' \
#       | sed -e 's/<span class="ltlbg_talk">/ã€Œ/g' \
#       | sed -e 's/<span class="ltlbg_talk2">/ã€/g' \
#       | sed -e 's/<span class="ltlbg_think">/ï¼ˆ/g' \
#       | sed -e 's/<span class="ltlbg_wquote">/ã€/g' \
#       | sed -e 's/<span class="ltlbg_dash">/â€•â€•/g' \
#       | sed -e 's/<span class="ltlbg_citation">/ï¼/g' \
#       >tmp2_ltlbgtmp

#       ## ç¸¦ä¸­æ¨ªã¨æ¨ªå¹…ä¿®æ­£ã‚’é™¤å»
#       cat tmp2_ltlbgtmp \
#       | sed -e 's/<span class=\"ltlbg_tcyA\">\([^<]\{2\}\)<\/span>/\1/g' \
#       | sed -e 's/<span class=\"ltlbg_wdfix\">\([^<]\)<\/span>/\1/g' \
#       >tmp1_ltlbgtmp

#       ## ã‚³ãƒ­ãƒ³ã¨ã‚»ãƒŸã‚³ãƒ­ãƒ³ã‚’å¾©æ—§
#       cat tmp1_ltlbgtmp \
#       | sed -e 's/<span class="ltlbg_semicolon">ï¼›<\/span>/ï¼›/g' \
#       | sed -e 's/<span class="ltlbg_colon">ï¼š<\/span>/ï¼š/g' \
#       >tmp2_ltlbgtmp

#       ## æ‹¬å¼§é¡ã®æ“¬ä¼¼æ®µè½è¨˜å·ã‚’é™¤å»
#       cat tmp2_ltlbgtmp \
#       | sed -e 's/<p class="ltlbg_p_brctGrp">//g' \
#       | sed -e 's/<\/p><\!--ltlbg_p_brctGrp-->//g' \
#       >tmp1_ltlbgtmp

#       ## <span class="ltlbg_dakuten">ã‚’ã€Œã‚›ã€ã«å¾©æ—§
#       ## <span class="ltlbg_tcyM">XX</span>ã‚’å¾©æ—§
#       ## <span class="ltlbg_wSize">å­—</span>ã‚’å¾©æ—§
#       ## <span class="ltlbg_odori1"></span><span class="ltlbg_odori2"></span>ã‚’å¾©æ—§
#       cat tmp1_ltlbgtmp \
#       | sed -e 's/<span class=\"ltlbg_dakuten\">\(.\)<\/span>/\1ã‚›/g' \
#       | sed -e 's/<span class=\"ltlbg_tcyM\">\([^<]\{1,3\}\)<\/span>/^\1^/g' \
#       | sed -e 's/<span class=\"ltlbg_wSize\">\(.\)<\/span>/\1\1/g' \
#       | sed -e 's/<span class=\"ltlbg_odori1\"><\/span>/ï¼/g' \
#       | sed -e 's/<span class=\"ltlbg_odori2\"><\/span>/ï¼¼/g' \
#       >tmp2_ltlbgtmp

#       ## å¼·åˆ¶åˆå­—<span class="ltlbg_forceGouji1">ã€<span class="ltlbg_forceGouji2">ã‚’[l[]r]ã¸å¾©æ—§
#       cat tmp2_ltlbgtmp \
#       | sed -e 's/<span class=\"ltlbg_forceGouji1\">\(.\)<\/span><span class=\"ltlbg_forceGouji2\">\(.\)<\/span>/[l[\1\2]r]/g' \
#       >tmp1_ltlbgtmp

#       ## å›è»¢æŒ‡å®š<span class="ltlbg_rotate"></span>ã‚’[^å­—^]ã¸å¾©æ—§
#       ## å¤ªå­—æŒ‡å®š<span class="ltlbg_bold"></span>ã‚’**å­—**ã¸å¾©æ—§
#       cat tmp1_ltlbgtmp \
#       | sed -e 's/<span class=\"ltlbg_rotate\">\(.\)<\/span>/\[\^\1\^\]/g' \
#       | sed -e 's/<span class=\"ltlbg_bold\">\([^<]\+\)<\/span>/\*\*\1\*\*/g' \
#       >tmp2_ltlbgtmp

#       ## <h2 class="ltlbg_sectionName">\1<\/h2>ã‚’è¡Œé ­â—†ã¸
#       ## <hr class="ltlbg_hr">ã‚’---ã¸ã€‚
#       cat tmp2_ltlbgtmp \
#       | sed -e 's/<h2 class=\"ltlbg_sectionName\">\([^<]\+\)<\/h2>/\1/g' \
#       | sed -e 's/<hr class=\"ltlbg_hr\">/---/g' \
#       >tmp1_ltlbgtmp

#       ## ãƒ¢ãƒãƒ«ãƒ“ã‚’å¾©æ—§
#       cat tmp1_ltlbgtmp >tmp2_ltlbgtmp
#       #3å›ç¹°ã‚Šè¿”ã™ã®ã§ãƒ«ãƒ¼ãƒ—æœ«å°¾ã§å‡ºåŠ›ã—ã¦ã„ã‚‹ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é–‹å§‹ã•ã‚Œã‚‹ã‚ˆã†èª¿æ•´ã™ã‚‹
#       cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
#     done

#     ############################################################################################
#     #è¤‡æ•°å›ã®ç½®æ›ã‚’å¿…è¦ã¨ã—ãªã„(é€”ä¸­ã§æˆ»ã‚‹ã¨ä¸éƒ½åˆã®ã‚ã‚‹)å¾©æ—§
#     ############################################################################################
#     ## ã€Œ&lt;ã€  ã‚’ã€Œ<ã€(åŠè§’)ã¸å¤‰æ›
#     ## ã€Œ&gt;ã€  ã‚’ã€Œ>ã€(åŠè§’)ã¸å¤‰æ›
#     ## ã€Œ&amp;ã€ ã‚’ã€Œ&ã€(åŠè§’)ã¸å¤‰æ›
#     ## ã€Œ&quot;ã€ã‚’ã€Œ'ã€(åŠè§’)ã¸å¤‰æ›
#     ## ã€Œ&#39;ã€ ã‚’ã€Œ"ã€(åŠè§’)ã¸å¤‰æ›
#     cat tmp2_ltlbgtmp \
#     | sed -e 's/&amp;/\&/g' \
#     | sed -e 's/&lt;/</g' \
#     | sed -e 's/&gt;/>/g' \
#     | sed -e 's/&quot;/'\''/g' \
#     | sed -e 's/&#39;/\"/g' \
#     >tmp1_ltlbgtmp

#     ## ã“ã“ã¾ã§ç”Ÿã˜ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ç©ºè¡Œã¯å‰¯ç”£ç‰©ãªã®ã§å‰Šé™¤
#     ## ãã®ä¸Šã§ã€<br class="ltlbg_br">ã€<br class="ltlbg_blankline">ã‚’å‰Šé™¤
#     cat tmp1_ltlbgtmp \
#     | sed -z 's/^\n//g' \
#     | sed -e 's/<br class=\"ltlbg_br\">//g' \
#     | sed -e 's/^<br class=\"ltlbg_blankline\">//g' \
#     | sed -e 's/<span class=\"ltlbg_wSp\"><\/span>/ã€€/g' \
#     | sed -e 's/<span class=\"ltlbg_sSp\"><\/span>/ /g' \
#     | sed -z 's/ã€€\n/\n/g' \
#     >tmp2_ltlbgtmp

#     #################################################################################
#     #ãƒ«ãƒ“ã¨å‚ç‚¹ã®å¾©æ—§ã¯æœ€å¾Œã€‚å‚ç‚¹ã¨ãƒ¢ãƒãƒ«ãƒ“ã¯ç‰¹æ®Šãªæˆ»ã—ä½œæ¥­ã‚’è¦ã™ã‚‹ã€‚
#     #################################################################################
#     ## ãƒ¢ãƒãƒ«ãƒ“ä»¥å¤–ã®<span class="ltlbg_ruby" data-ruby_XXX="XXX"></span>ã‚’å¾©æ—§
#     cat tmp2_ltlbgtmp \
#     | sed -e 's/<ruby class="ltlbg_ruby" data-ruby_[^=]\+="\([^"]\+\)">\([^<]\+\)<rt>[^<]\+<\/rt><\/ruby>/{\2ï½œ\1}/g' \
#     >tmp1_ltlbgtmp

#     #é †åºã®å…¥ã‚Œæ›¿ãˆ
#     cat tmp1_ltlbgtmp \
#     | sed -e 's/\*\*{\([^ï½œ]\+\)ï½œ\([^\}]\+\)}\*\*/{\*\*\1\*\*ï½œ\2}/g' \
#     > tmp2_ltlbgtmp

#     ## å‚ç‚¹ã‚¿ã‚°ã‚’ã€Šã€ŠåŸºåº•æ–‡å­—ã€‹ã€‹ã¸å¾©æ—§ã™ã‚‹
#     ## <ruby class=\"ltlbg_emphasis\" data-ruby_emphasis=\"[^]]\">ã€œã§æŠ½å‡ºã—ãŸã‚‚ã®ã‚’ç½®æ›å…ƒã¨ã™ã‚‹ã€‚
#     ## åŸºåº•æ–‡å­—ã ã‘ã‚’æŒã¤ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã€ãƒ«ãƒ“ã ã‘ã‚’æŒã¤ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ç½®æ›å…ˆã¨ã™ã‚‹ã€‚
#     ## ç½®æ›æ©Ÿèƒ½ã‚’æŒã£ãŸä¸­é–“ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€å®Ÿè¡Œã™ã‚‹ã€‚
#     cat tmp2_ltlbgtmp \
#     | sed -e 's/<ruby class=\"ltlbg_emphasis\" data-emphasis=\".\">\([^<]\+\)<rt>.<\/rt><\/ruby>/ã€Šã€Š\1ã€‹ã€‹/g' \
#     >tmp1_ltlbgtmp

#     #3å›ç¹°ã‚Šè¿”ã™ã®ã§ãƒ«ãƒ¼ãƒ—æœ«å°¾ã§å‡ºåŠ›ã—ã¦ã„ã‚‹ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é–‹å§‹ã•ã‚Œã‚‹ã‚ˆã†èª¿æ•´ã™ã‚‹
#     #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
#   done
#   # ãƒ«ãƒ¼ãƒ—çµ‚äº†å¾Œã®çµæœã‚‚tmp1_ltlbgtmpã«å‡ºåŠ›ã•ã‚Œã‚‹

#   # ãƒ¢ãƒãƒ«ãƒ“å¯¾å¿œã€‚#######################################################
#   # ãƒ¢ãƒãƒ«ãƒ“ã¯ã€ã“ã“ã¾ã§ã®å‡¦ç†ã§ã¯{ãƒ¢ãƒãƒ«ãƒ“ï½œã‚‚ã®ã‚‹ã³}ã§ã¯ãªã
#   # {ãƒ¢ï½œã‚‚}{ãƒï½œã®}{ãƒ«ï½œã‚‹}{ãƒ“ï½œã³}ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã“ã‚Œã‚’å¾©æ—§ã™ã‚‹ã€‚
#   # å…¥åŠ›ã¯tmp1_ltlbgtmpã®æƒ³å®šã€‚
#   #######################################################################
#   #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
#   cat tmp1_ltlbgtmp >monorubyInput_ltlbgtmp 

#   cat monorubyInput_ltlbgtmp \
#   | grep -E -o '(\{[^ï½œ]+ï½œ[^}]+\}){2,}' \
#   | uniq \
#   | sed -e 's/\//\\\//g' \
#   | sed -e 's/\[/\\\[/g' \
#   | sed -e 's/\]/\\\]/g' \
#   | sed -e 's/\^/\\\^/g' \
#   | sed -e 's/\~/\\\~/g' \
#   | sed -e 's/\*/\\\*/g' \
#   | sed -e 's/\"/\\\"/g' \
#   > tgt_ltlbgtmp

#   if [ -s tgt_ltlbgtmp ]; then
#     cat tgt_ltlbgtmp \
#     | while read line || [ -n "${line}" ]; do \
#         echo ${line} \
#         | grep -E -o '\{[^ï½œ]+ï½œ' \
#         | sed -e 's/^{//g' \
#         | sed -e 's/ï½œ$//g' \
#         | sed -z 's/\n//g' \
#         | sed -e 's/^/\{/g' \
#             | sed -e 's/\//\\\//g' \
#             | sed -e 's/\[/\\\[/g' \
#             | sed -e 's/\]/\\\]/g' \
#             | sed -e 's/\^/\\\^/g' \
#             | sed -e 's/\~/\\\~/g' \
#             | sed -e 's/\*/\\\*/g' \
#             | sed -e 's/\"/\\\"/g' \

#         echo -n 'ï½œ'

#         echo ${line} \
#         | grep -E -o 'ï½œ[^}]+\}' \
#         | sed -e 's/^ï½œ//g' \
#         | sed -e 's/}$//g' \
#         | sed -z 's/\n//g' \
#         | sed -e 's/$/\}/g' \
#             | sed -e 's/\//\\\//g' \
#             | sed -e 's/\[/\\\[/g' \
#             | sed -e 's/\]/\\\]/g' \
#             | sed -e 's/\^/\\\^/g' \
#             | sed -e 's/\~/\\\~/g' \
#             | sed -e 's/\*/\\\*/g' \
#             | sed -e 's/\"/\\\"/g' \

#         echo ''
#     done \
#     > rep_ltlbgtmp

#     paste -d '/' tgt_ltlbgtmp rep_ltlbgtmp \
#     | sed -e 's/^/| sed -e '\''s\//g' \
#     | sed -e 's/$/\/g'\'' \\/g' \
#     | sed -z 's/^/cat monorubyInput_ltlbgtmp \\\n/g' \
#     > tmp.sh
#     bash tmp.sh >monorubyOutput_ltlbgtmp
#   else 
#     cat monorubyInput_ltlbgtmp >monorubyOutput_ltlbgtmp
#   fi
#   cat monorubyOutput_ltlbgtmp >tmp1_ltlbgtmp
#   ########################ãƒ¢ãƒãƒ«ãƒ“å¯¾å¿œã“ã“ã¾ã§ã€‚å‡ºåŠ›ã¯tmp1_ltlbgtmp

#   #å‚ç‚¹å¯¾å¿œ#################################################################################
#   # å‚ç‚¹ã¯1å­—ãšã¤è¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã“ã“ã¾ã§ã®å‡¦ç†ã§ã¯
#   # ã€Šãƒ¢ãƒãƒ«ãƒ“ã€‹ã§ã¯ãªãã€Šãƒ¢ã€‹ã€Šãƒã€‹ã€Šãƒ«ã€‹ã€Šãƒ«ãƒ“ã€‹ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã“ã‚Œã‚’å¾©æ—§ã™ã‚‹
#   # å…¥åŠ›ã¯tmp1_ltlbgtmpã®æƒ³å®š
#   ##########################################################################################
#   #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
#   cat tmp1_ltlbgtmp >emphasisInput_ltlbgtmp 
#   cat emphasisInput_ltlbgtmp \
#   | grep -E -o '(ã€Šã€Š[^ã€‹]+ã€‹ã€‹[ ã€€]?){2,}' \
#   | uniq \
#   >emphtmp_ltlbgtmp

#   #ã€Šã€Šã€‹ã€‹ãŒé€£ç¶šã—ã¦ã„ã‚‹(è¤‡æ•°æ–‡å­—ã®å‚ç‚¹)ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°å®Ÿæ–½ã—ãªã„
#   if [[ -s emphtmp_ltlbgtmp ]]; then 
#     cat emphtmp_ltlbgtmp \
#     | sed -e 's/\//\\\//g' \
#     | sed -e 's/\[/\\\[/g' \
#     | sed -e 's/\]/\\\]/g' \
#     | sed -e 's/\^/\\\^/g' \
#     | sed -e 's/\~/\\\~/g' \
#     | sed -e 's/\*/\\\*/g' \
#     | sed -e 's/\"/\\\"/g' \
#     | sed -e 's/^/| sed -e '\''s\//g' \
#     >tgt_ltlbgtmp

#     cat emphtmp_ltlbgtmp \
#     | sed -e 's/[ã€Šã€‹]//g' \
#     | sed -e 's/^/ã€Šã€Š/g' \
#     | sed -e 's/$/ã€‹ã€‹/g' \
#     | sed -e 's/$/\/g'\'' \\/g' \
#     >rep_ltlbgtmp

#     paste -d '/t' tgt_ltlbgtmp rep_ltlbgtmp \
#     | sed -z 's/^/cat emphasisInput_ltlbgtmp \\\n/g' \
#     >tmp.sh
#     bash tmp.sh > emphasisOutput_ltlbgtmp
#   else
#     cat emphasisInput_ltlbgtmp >emphasisOutput_ltlbgtmp
#   fi

#   cat emphasisOutput_ltlbgtmp >tmp1_ltlbgtmp
#   ########################å‚ç‚¹å¯¾å¿œã“ã“ã¾ã§ã€‚å‡ºåŠ›ã¯tmp1_ltlbgtmpã®æƒ³å®š

#   cat tmp1_ltlbgtmp >${destFile}
#   echo "âœ¨ "${destFile}"ã‚’å‡ºåŠ›ã—ã¾ã—ãŸ[txtã‚‚ã©ã—]"
# fi
=======
tgtFile=${2}   #å¼•æ•°ã§æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è±¡ã¨ã™ã‚‹

if [[ "${tgtFile/ /}" = "" ]];then
  echo "ğŸ’©å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ãã ã•ã„"
  exit 1
fi

tgtFile_AfterCD='../'${tgtFile}   #ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å†…å´ã‹ã‚‰å‚ç…§ã™ã‚‹ã¨ãç”¨

if [ ! -e ${tgtFile} ]; then
  echo "ğŸ’© ${tgtFile}ãªã‚“ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã„ãªã„ã§ã™"
  exit 1
fi

convMode=${1}  #'-t2h'ã§txtâ†’htmlã€'-h2t'ã§htmlâ†’txtã€ãã‚Œä»¥å¤–ã¯ä»Šã®æ‰€ã¯ã‚¨ãƒ©ãƒ¼

if [[ "${convMode}" != '-t2h' ]] && [[ "${convMode}" != '-h2t' ]] ; then
  echo "ğŸ’© å¼•æ•°1ã¯-t2h(txtâ†’html)ã‹-h2t(htmlâ†’txt)ã§æŒ‡å®šã—ã¦ãã ã•ã„"
  exit 1
fi

chrset=$(file -i ${tgtFile})
tmpDirName=$(mktemp -u ltlbgtmpDir_XXXXX)  #ä½œæ¥­ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—
mkdir ${tmpDirName}                        #ãã®ä¸­ã§ä½œæ¥­ã™ã‚‹ã€‚
cd ${tmpDirName}                           #æœ€å¾Œã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨å‰Šé™¤ã™ã‚‹ã€‚

if [ "${chrset##*charset=}" = "unknown-8bit" ]; then
  iconv -f SHIFT_JIS -t UTF-8 ${tgtFile_AfterCD} > tmp1_ltlbgtmp
  cat tmp1_ltlbgtmp >${tgtFile_AfterCD}
fi

if [ "${convMode}" = '-t2h' ] ; then

  ## txtâ†’html ############################################################################################

  destFile=${tgtFile_AfterCD/".txt"/"_tagged.html"} #å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã™ã‚‹
  touch ${destFile}                        #å‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ

  ##è­¦å‘Šè¡¨ç¤º####################################################################
  # å¤‰æ›ä¸èƒ½ãªã‚±ãƒ¼ã‚¹ã‚’äºˆã‚æŠ½å‡ºã™ã‚‹ã€‚
  # å‡¦ç†ã¯ä¸­æ–­ã›ãšæœ€å¾Œã¾ã§è¡Œã†ãŒã€è­¦å‘Šè¡¨ç¤ºã‚’è¡Œã†ã€‚
  # ãŠãã‚‰ãå¤‰æ›å‡¦ç†ã¯æˆåŠŸã—ãªã„ã€‚
  ##############################################################################
  ## ãƒ«ãƒ“æŒ‡å®šã®åŸºåº•æ–‡å­—ã«åœç‚¹ã®åŒæ™‚æŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '(\{ã€Šã€Š[^ã€‹]+ã€‹ã€‹ï½œ[^\}]+\})|(ã€Šã€Š{[^ï½œ]+ï½œ[^\}]+}ã€‹ã€‹)' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“ã¨åœç‚¹ãŒåŒæ™‚ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›çµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  ## ç¸¦ä¸­æ¨ªæŒ‡å®šã®ä¸€éƒ¨ã«å¤ªå­—æŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '(\^[^\*]+\*\*10\*\*[^\^]?\^)|(\^[^\*]?\*\*10\*\*[^\^]+\^)' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§ç¸¦ä¸­æ¨ªã®ä¸€éƒ¨ã«ã ã‘å¤ªå­—ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›çµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  # 4æ–‡å­—ä»¥ä¸Šã®ç¸¦ä¸­æ¨ª
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '\^[a-zA-Z0-9]{4,}\^' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§4æ¡ä»¥ä¸Šã®ç¸¦ä¸­æ¨ªãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  # ç¸¦ä¸­æ¨ªæŒ‡å®šã®ä¸€éƒ¨ã«ã®ã¿åœç‚¹æŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '(\^[a-zA-Z0-9]?ã€Šã€Š[a-zA-Z0-9]+ã€‹ã€‹[a-zA-Z0-9]+\^)|\^[a-zA-Z0-9]+ã€Šã€Š[a-zA-Z0-9]+ã€‹ã€‹[a-zA-Z0-9]?\^' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§ç¸¦ä¸­æ¨ªã®ä¸€éƒ¨ã«åœç‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  # ãƒ«ãƒ“æŒ‡å®šå…¨ä½“ã«å›è»¢æŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '\[\^\{[^ï½œ]+ï½œ[^\}]+\}\^\]' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“æŒ‡å®šã®å…¨ä½“ã«å›è»¢ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  # å¼·åˆ¶åˆå­—ã®ä¸€éƒ¨ã‚’å¤ªå­—æŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '\[l\[\*\*.\*\*.\]r\]' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§åˆå­—ç”ŸæˆæŒ‡å®šã®ä¸€éƒ¨ã«ã®ã¿å¤ªå­—ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸é©åˆ‡ãªæŒ‡å®šã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  # å¼·åˆ¶åˆå­—ã®ä¸€éƒ¨ã«å›è»¢æŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '(\[l\[.\^.\^\]r\])|(\^\[l\[[^]]{2}\]r\]\^)' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§åˆå­—ç”Ÿæˆã¨å›è»¢ãŒåŒæ™‚ã«æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  # ã‚¢ã¸æ¿ç‚¹ã«å›è»¢æŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '\[\^.ã‚›\^\]' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§æ¿ç‚¹åˆå­—ã¨å›è»¢ãŒåŒæ™‚ã«æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi
  # ãƒ«ãƒ“æ–‡å­—ã«ç‰¹æ®ŠæŒ‡å®š
  cat ${tgtFile_AfterCD} \
  | grep -E -o -n '(\{[^ï½œ]+ï½œ[^\*]?\*\*[^\*]+\*\*[^\*]?\})|({[^ï½œ]+ï½œ[^}]?\[\^[^\}]+\^\][^ï½œ]?})|({[^ï½œ]+ï½œ[^}]?ã€Šã€Š[^}]+ã€‹ã€‹[^}]?\})|({[^ï½œ]+ï½œ{[^ï½œ]+ï½œ[^\}]+\}\})|({[^ï½œ]+ï½œ[^\}]?\[l\[[^]]{2}\]r\][^\}]?\})' \
  >warn_ltlbgtmp
  if [ -s warn_ltlbgtmp ] ; then 
    cat warn_ltlbgtmp
    echo 'ğŸ¤” â†‘ã§ãƒ«ãƒ“æ–‡å­—ã«ä¿®é£¾ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å¤‰æ›ã¯éå¯¾å¿œã§ã™ã€‚å¤‰æ›ã¯å®Ÿæ–½ã—ã¾ã™ãŒçµæœã¯ä¿è¨¼ã•ã‚Œã¾ã›ã‚“ã€‚' 
  fi

  # è­¦å‘Šè¡¨ç¤ºã“ã“ã¾ã§############################################################
  ##########################################################################################
  # å…ˆè¡Œå¤‰æ›ï¼šç‰¹æ®Šæ–‡å­—ãªã©ã€htmlã‚¿ã‚°ã«å«ã¾ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã‚‚ã®ã‚’å…ˆã«ç½®æ›ã™ã‚‹
  ##########################################################################################
  ## ã€Œ&ã€(åŠè§’)ã‚’ã€Œï¼†ï½ï½ï½ã€ã¸å¤‰æ›
  ## ã€Œ<ã€(åŠè§’)ã‚’ã€Œ&ï½Œï½”ã€ã¸å¤‰æ›(æœ€åˆã‹ã‚‰&lt;ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’è€ƒæ…®)
  ## ã€Œ>ã€(åŠè§’)ã‚’ã€Œ&ï½‡ï½”ã€ã¸å¤‰æ›(æœ€åˆã‹ã‚‰&gt;ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’è€ƒæ…®)
  ## ã€Œ'ã€(åŠè§’)ã‚’ã€Œ&ï½‘ï½•ï½ï½”ã€ã¸å¤‰æ›(æœ€åˆã‹ã‚‰&quot;ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’è€ƒæ…®)
  ## ã€Œ"ã€(åŠè§’)ã‚’ã€Œï¼†ï¼ƒï¼“ï¼™ã€ã¸å¤‰æ›(æœ€åˆã‹ã‚‰&#39;ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’è€ƒæ…®)
  ## ã€Œ/ã€(åŠè§’)ã‚’ã€Œï¼†ï¼ƒï¼ï¼”ï¼—ã€ã¸å¤‰æ›(æœ€åˆã‹ã‚‰&#047;ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’è€ƒæ…®)
  ## â€»å…¨è§’ã§ã‚ã‚‹ã“ã¨ã€ï¼›ã‚’ã¤ã‘ãªã„ã¯ä»¥é™ã®å¤‰æ›ã«å¼•ã£ã‹ã‹ã‚‰ãªã„ã‚ˆã†ã«ã€‚
  ## æœ€å¾Œã«å¾©æ—§ã™ã‚‹ã€‚
  ## â€•â€•ã‚’â€•ã¸å¤‰æ›
  ## æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’lfã«çµ±ä¸€
  cat ${tgtFile_AfterCD} \
  | sed -e 's/\&/ï¼†ï½ï½ï½/g' \
  | sed -e 's/\&amp;/ï¼†ï½ï½ï½/g' \
  | sed -e 's/\//ï¼†ï¼ƒï¼ï¼”ï¼—/g' \
  | sed -e 's/\(\(\&\|ï¼†ï½ï½ï½\)#047;|\/\)/ï¼†ï¼ƒï¼ï¼”ï¼—/g' \
  | sed -e 's/\\/ï¼†ï¼ƒï¼ï¼™ï¼’/g' \
  | sed -e 's/\(\&\|ï¼†ï½ï½ï½\)#092;/ï¼†ï¼ƒï¼ï¼™ï¼’/g' \
  | sed -e 's/>/ï¼†ï½‡ï½”/g' \
  | sed -e 's/\(\&\|ï¼†ï½ï½ï½\)gt;/ï¼†ï½‡ï½”/g' \
  | sed -e 's/</ï¼†ï½Œï½”/g' \
  | sed -e 's/\(\&\|ï¼†ï½ï½ï½\)lt;/ï¼†ï½Œï½”/g' \
  | sed -e 's/'\''/ï¼†ï¼ƒï¼“ï¼™/g' \
  | sed -e 's/\(\&\|ï¼†ï½ï½ï½\)#39;/ï¼†ï¼ƒï¼“ï¼™/g' \
  | sed -e 's/\"/ï¼†ï½‘ï½•ï½ï½”/g' \
  | sed -e 's/\(\&\|ï¼†ï½ï½ï½\)#quot;/ï¼†ï½‘ï½•ï½ï½”/g' \
  | sed -e 's/â€•â€•/â€•/g' \
  | sed -z 's/\r\n/\n/g' | sed -z 's/\r/\n/g' \
  >tmp1_ltlbgtmp

  ## è¡Œé ­ã«ã—ã‹ç™»å ´ã—ãªã„æ‹¬å¼§é¡ã®è£œå®Œ
  cat tmp1_ltlbgtmp \
  | sed -e 's/^â€•\(.\+\)/â€•\1â€•/g' \
  | sed -e 's/^ï¼\(.\+\)/ï¼\1ï¼œ/g' \
  >tmp2_ltlbgtmp

  cat tmp2_ltlbgtmp >tmp1_ltlbgtmp


  #å¤‰æ›å‡¦ç†ã®éƒ½åˆã§ã€ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—æ‹¬ã‚Šé †ã‚’å…¥ã‚Œæ›¿ãˆã‚‹########################################
  #â€»è¤‡æ•°æ–‡å­—ã‚’å¯¾è±¡ã«ã§ãã‚‹ã‚¿ã‚°ã‚’å¤–å´ã«####################################################
  ## [^ã€Šã€Šå­—ã€‹ã€‹^]ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¯ã€ã€Šã€Š[^å­—^]ã€‹ã€‹ã¸é †åºäº¤æ›ã™ã‚‹
  ## ^**å­—**^ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¯ã€**^å­—^**ã¸é †åºäº¤æ›ã™ã‚‹
  ## ^ã€Šã€Šå­—ã€‹ã€‹^ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¯ã€ã€Šã€Š^å­—^ã€‹ã€‹ã¸é †åºäº¤æ›ã™ã‚‹
  ## ^{åŸºåº•æ–‡å­—ï½œãƒ«ãƒ“}^ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¯ã€{^åŸºåº•æ–‡å­—^ï½œãƒ«ãƒ“}ã¸é †åºäº¤æ›ã™ã‚‹
  ## [^**åŸºåº•æ–‡å­—**^]ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¯ã€**[^åŸºåº•æ–‡å­—^]**ã¸é †åºäº¤æ›ã™ã‚‹
  cat tmp1_ltlbgtmp \
  | sed -e 's/\[\^ã€Šã€Š\([^\*]\+\)ã€‹ã€‹\^\]/ã€Šã€Š\[\^\1\^\]ã€‹ã€‹/g' \
  | sed -e 's/\^\*\*\([^\*]\+\)\*\*\^/\*\*\^\1\^\*\*/g' \
  | sed -e 's/\^ã€Šã€Š\([^\*]\+\)ã€‹ã€‹\^/ã€Šã€Š\^\1\^ã€‹ã€‹/g' \
  | sed -e 's/\^{\([^ï½œ]\+\)ï½œ\([^}]\+\)}\^/{\^\1\^ï½œ\2}/g' \
  | sed -e 's/ã€Šã€Š\*\*\([^\*]\+\)\*\*ã€‹ã€‹/\*\*ã€Šã€Š\1ã€‹ã€‹\*\*/g' \
  | sed -e 's/\[\^\*\*\([^\*]\+\)\*\*\^\]/\*\*\[\^\1\^\]\*\*/g' \
  >tmp2_ltlbgtmp

  #ç‰¹æ®Šæ–‡å­—å¤‰æ›é¡ç½®æ›ã“ã“ã¾ã§##############################################################
  #########################################################################################
  # æ–‡ç« ä¸­ã«ç™»å ´ã™ã‚‹ã‚¹ãƒšãƒ¼ã‚¹é¡ã¯ã™ã¹ã¦ã‚¿ã‚°ã¸ç½®æ›ã™ã‚‹ã€‚
  # ä»¥é™ç™»å ´ã™ã‚‹ã‚¹ãƒšãƒ¼ã‚¹é¡ã¯htmlä¸Šã®åŒºåˆ‡ã‚Šæ–‡å­—ã¨ã—ã¦ã®ã‚¹ãƒšãƒ¼ã‚¹ã®ã¿ã§ã€ç½®æ›å¯¾è±¡ã§ã¯ãªã„
  # ä»¥é™ã§ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç½®æ›ã—ãŸã„å ´åˆã¯ã€ç©ºç™½ã‚¯ãƒ©ã‚¹ã®ã‚¿ã‚°ã‚’ç½®æ›ã™ã‚‹ã“ã¨
  #########################################################################################
  cat tmp2_ltlbgtmp >tmp1_ltlbgtmp

  ## åŠè§’SPã‚’<span class="ltlbg_sSp">ã¸ã€‚
  ## ç‰¹å®šã®è¨˜å·(ã®é€£ç¶š)ã®ã‚ã¨ã«å…¨è§’SPã‚’æŒ¿å…¥ã™ã‚‹ã€‚ç›´å¾Œã«é–‰ã˜æ‹¬å¼§é¡ã€æ”¹è¡Œã€ã€Œã‚›ã€ãŒã‚ã‚‹å ´åˆã¯å›é¿ã™ã‚‹
  ## è¡Œé ­ä»¥å¤–ã®å…¨è§’SPã‚’<span class="ltlbg_wSp">ã¸ã€‚
  cat tmp1_ltlbgtmp \
  | sed -e 's/\ /<span class=\"ltlbg_sSp\"><\/span>/g' \
  | sed -e 's/\([ï¼ï¼Ÿâ™¥â™ªâ˜†\!\?]\+\)ã€€\?/\1ã€€/g' \
  | sed -e 's/ã€€\([ã€ã€ï¼‰ã€Ÿã‚›/n]\)/\1/g' \
  | sed -e 's/\(.\)ã€€/\1<span class=\"ltlbg_wSp\"><\/span>/g' \
  >tmp2_ltlbgtmp

  # ç« åŒºåˆ‡ã‚Šå‰å¾Œã®ç©ºè¡Œã‚’å‰Šé™¤ã™ã‚‹
  ## äº‹å‰ã«ã€ä½œå“å†’é ­ã«ç©ºè¡ŒãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤ã™ã‚‹
  cat tmp2_ltlbgtmp \
  | sed -z 's/\n*\(\[chapter[^]]\+\]\)\n\+/\n\1\n/g' \
  | sed -z '1,/^\n*/s/^\n*//' \
  >tmp1_ltlbgtmp
  ## æ–‡ç« ä¸­ã‚¹ãƒšãƒ¼ã‚¹é¡ç½®æ›ã“ã“ã¾ã§###########################################################

  ##########################################################################################
  ##å…ˆè¡Œå¤‰æ›ï¼š åœç‚¹ã®ä¸­ã«è‡ªå‹•ç¸¦ä¸­æ¨ªãŒå«ã¾ã‚Œã‚‹ã‚‚ã®ã®å¯¾å¿œå¯¾å¿œ
  ##########################################################################################
  #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp

  ## è‹±æ•°å­—2æ–‡å­—ã¨ã€ï¼ï¼Ÿ!?ã®é‡ãªã‚Šã‚’<span class="ltlbg_tcyA">ã®å¤‰æ›å¯¾è±¡ã«ã™ã‚‹
  cat tmp1_ltlbgtmp \
  | LANG=C sed -e 's/\([^a-zA-Z0-9\<\>\^]\)\([a-zA-Z0-9]\{2\}\)\([^a-zA-Z0-9\<\>\^]\)/\1~\2~\3/g' \
  | sed -e 's/\([^!ï¼?ï¼Ÿ\&#;]\)\(!!\|ï¼ï¼\)\([^!ï¼?ï¼Ÿ\&#;]\)/\1~!!~\3/g' \
  | sed -e 's/\([^!ï¼?ï¼Ÿ\&#;]\)\(??\|ï¼Ÿï¼Ÿ\)\([^!ï¼?ï¼Ÿ\&#;]\)/\1~??~\3/g' \
  | sed -e 's/\([^!ï¼?ï¼Ÿ\&#;]\)\(!?\|ï¼ï¼Ÿ\)\([^!ï¼?ï¼Ÿ\&#;]\)/\1~!?~\3/g' \
  | sed -e 's/\([^!ï¼?ï¼Ÿ\&#;]\)\(?!\|ï¼Ÿï¼\)\([^!ï¼?ï¼Ÿ\&#;]\)/\1~?!~\3/g' \
  >tmp2_ltlbgtmp

#TODO:[capter]ã«ã‚ˆã‚‹ç« æŒ‡å®šã‚’å»ƒæ­¢ã€‚ãªãã¦å•é¡Œãªã•ãã†ãªã‚‰æ°¸ç¶šçš„ã«å‰Šé™¤ã™ã‚‹
#
#  ## [capter]ã‚’<section class="ltlbg_section">ã«ã€‚:XXXXXã¯id="XXXX"ã«ã€‚
#  ## ç« åŒºåˆ‡ã‚Šã®ãªã„æ–‡ç« å¯¾å¿œã§ã€å…ˆé ­ã«å¿…ãšç« ã‚’ä»˜ä¸ã—ã€é‡ãªã£ãŸç« é–‹å§‹ã‚’é™¤å»
#  cat tmp2_ltlbgtmp \
#  | sed -z 's/^/<section class=\"ltlbg_section\">\n/g' \
#  | sed -e 's/\[chapter:/[chapter id=/g' \
#  | sed -e 's/\[chapter\( id=\([^[]\+\)\)\?\]/<section class="ltlbg_section"\1>/g' \
#  | sed -e 's/id=\([^>]\+\)\+>/id=\"\1\">/' \
#  | sed -z 's/<section class=\"ltlbg_section\">\n<section class=\"ltlbg_section\"/<section class=\"ltlbg_section\"/g' \
#  >tmp1_ltlbgtmp
#
#  ## ç« ã‚’é–‰ã˜ã‚‹
#  ## ç½®æ›ã®éƒ½åˆä¸Šå¿…ãšç”Ÿã˜ã‚‹å…ˆé ­ã®ç« é–‰ã˜ã¯å‰Šé™¤
#  ## ä½œå“ã®æœ«å°¾ã«ã¯å¿…ãšç« é–‰ã˜ã‚’ä»˜ä¸
#  ## ç« åŒºåˆ‡ã‚Šã¯è¤‡æ•°è¡Œã«æ¸¡ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§é–‰ã˜ã‚¿ã‚°ã«<\!--ltlbg_section-->ã‚’ä»˜ä¸ã™ã‚‹
#  cat tmp1_ltlbgtmp \
#  | sed -e 's/<section/<\/section><\!--ltlbg_section-->\n<section/g' \
#  | sed -z '1,/<\/section><\!--ltlbg_section-->\n/s/<\/section><\!--ltlbg_section-->\n//' \
#  | sed -z 's/$/\n<\/section><\!--ltlbg_section-->\n/' \
#  >tmp2_ltlbgtmp

  ## è¡Œé ­Â§Â§Â§ã®æ¬¡ã«ç©ºç™½(ãªãã¦ã‚‚è‰¯ã„)ã«ç¶šãè¡Œã‚’ã€<h2 class="ltlbg_sectionName" style="page: sukebe;">ç« ã‚¿ã‚¤ãƒˆãƒ«ã«
  ### style="page: sukebe;"ã¯CSSå´ã§ã€å½“è©²ã‚»ã‚¯ã‚·ãƒ§ãƒ³(ã«å±ã™ãƒšãƒ¼ã‚¸)ãŒã‚¨ãƒƒãƒã‚·ãƒ¼ãƒ³ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
  ### ':'';'ã¯å½“ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§ç‰¹æ®Šæ–‡å­—ã¨ã—ã¦æ“ä½œã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã«ã¯å«ã‚ãšã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æœ€å¾Œã«ä»˜ä¸ã—ç›´ã—ã¦ã„ã‚‹
  ### å°åˆ·ä¸Šã¯Â§ï¼‘ã¤ã ã‘ã«ãªã‚‹
  ## è¡Œé ­Â§ã®æ¬¡ã«ç©ºç™½(ãªãã¦ã‚‚è‰¯ã„)ã«ç¶šãè¡Œã‚’ã€<h2 class="ltlbg_sectionName">ç« ã‚¿ã‚¤ãƒˆãƒ«ã«
  ## ç« ã‚¿ã‚¤ãƒˆãƒ«ä»˜ä¸æ™‚ã«ã€<section>ã®é–‰ã˜ï¼‹é–‹å§‹ã‚¿ã‚°ã‚’ä»˜ä¸ã™ã‚‹ã€‚
  ## 1è¡Œç›®ãŒ</section><!--ltlbg_section-->ã«ãªã‚‹ã®ã§ã€å‰Šé™¤ã™ã‚‹
  ## ä»Šã¯Â§ã§ç¯€ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹
  cat tmp2_ltlbgtmp \
  | sed -e 's/^\(Â§Â§Â§\)\(.\{0,\}\)/<\/section><\!--ltlbg_section-->\n<section class=\"ltlbg_section\" style=\"page sukebe\"><h2 class=\"ltlbg_sectionName\">Â§ \2<\/h2>/g' \
  | sed -e 's/^\(Â§\)\(.\{0,\}\)/<\/section><\!--ltlbg_section-->\n<section class=\"ltlbg_section\"><h2 class=\"ltlbg_sectionName\">Â§ \2<\/h2>/g' \
  | sed -e '1d' \
  >tmp1_ltlbgtmp

  ## è¡Œé ­å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã§å§‹ã¾ã‚‹è¡Œã‚’<p>ã‚¿ã‚°ã«
  ## è¡Œé ­æ‹¬å¼§é¡ã®å‰ã«<div class="ltlbg_div_brctGrp">ã‚¿ã‚°
  cat tmp1_ltlbgtmp \
  | sed -e 's/^ã€€\(.\+\)/<p class=\"ltlbg_p\">\1<\/p><\!--ltlbg_p-->/g' \
  | sed -e 's/^\([ã€Œï¼ˆâ€•ã€ï¼].\+[ã€ã€ï¼‰ã€Ÿâ€•ï¼œ]\)/<div class=\"ltlbg_div_brctGrp\">\1\n<\/div><\!--ltlbg_div_brctGrp-->/g' \
  >tmp2_ltlbgtmp

  #ltlbg_div_brctGrp(div)ã‚¿ã‚°ã®æ•´ç†
  cat tmp2_ltlbgtmp \
  | sed -z 's/<div class=\"ltlbg_div_brctGrp\">/<div class=\"ltlbg_div_brctGrp\">\n/g' \
  | sed -z 's/\([ã€ã€ï¼‰ã€Ÿâ€•ï¼œ]\)\n<\/div><\!--ltlbg_div_brctGrp-->\n<div class=\"ltlbg_div_brctGrp\">\n\([ã€Œï¼ˆã€ã€â€•ï¼]\)/\1\n\2/g' \
  >tmp1_ltlbgtmp

  ## æ”¹è¡Œâ†’æ”¹è¡Œã‚¿ã‚°
  ## crlfâ†’lf ã—ã¦ã‹ã‚‰ lfâ†’<br class="ltlbg_br">+lfã«
  ## ä½†ã—ç›´å‰ã«ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ (ç« åŒºåˆ‡ã‚Šã€æ®µè½åŒºåˆ‡ã‚Šã€ç« ã‚¿ã‚¤ãƒˆãƒ«ã€æ”¹ãƒšãƒ¼ã‚¸ãªã©)ãŒã‚ã‚‹å ´åˆã¯ã€é™¤å»ã—ç›´ã™
  cat tmp1_ltlbgtmp \
  | sed -z 's/\n/<br class=\"ltlbg_br\">\n/g' \
  | sed -e 's/<\/h2><br class=\"ltlbg_br\">/<\/h2>/g' \
  | sed -e 's/<div class=\"ltlbg_div_brctGrp\"><br class=\"ltlbg_br\">/<div class=\"ltlbg_div_brctGrp\">/g' \
  | sed -e 's/<\/div><\!--ltlbg_div_brctGrp--><br class=\"ltlbg_br\">/<\/div><\!--ltlbg_div_brctGrp-->/g' \
  | sed -e 's/\(<section.*>\)<br class=\"ltlbg_br\">/\1/g' \
  | sed -z 's/<\/p><\!--ltlbg_p--><br class=\"ltlbg_br\">\n<div class=\"ltlbg_div_brctGrp\">/<\/p><\!--ltlbg_p-->\n<div class=\"ltlbg_div_brctGrp\">/g' \
  | sed -z 's/\(<br class=\"ltlbg_br\">\n\)\+<h2 class=\"ltlbg_sectionName\">/\n<h2 class=\"ltlbg_sectionName\">/g' \
  | sed -z 's/<\/h2>\(\n<br class=\"ltlbg_br\">\)\+/<\/h2>/g' \
  | sed -z 's/<\/section><\!--ltlbg_section--><br class=\"ltlbg_br\">/<\/section><\!--ltlbg_section--\>/g' \
  >tmp2_ltlbgtmp

  cat tmp2_ltlbgtmp \
  | sed -e 's/^<br class=\"ltlbg_br\">/<br class=\"ltlbg_blankline\">/' \
  | sed -z 's/<br class=\"ltlbg_blankline\">\n<p class=\"ltlbg_p\">/<p class=\"ltlbg_p\">/g' \
  | sed -z 's/<br class=\"ltlbg_blankline\">\n<div class=\"ltlbg_div_brctGrp\">/<div class=\"ltlbg_div_brctGrp\">/g' \
  | sed -e 's/<\/p><\!--ltlbg_p--><br class=\"ltlbg_br\">/<\/p><\!--ltlbg_p-->/g' \
  >tmp1_ltlbgtmp

  ## è¡Œé ­ã€Œã§ã¯ã˜ã¾ã‚‹ã€ã€ã¾ã§ã‚’<p class="ltlbg_talk">ã«ã™ã‚‹
  ## è¡Œé ­ï¼ˆã§ã¯ã˜ã¾ã‚‹ã€ï¼‰ã¾ã§ã‚’<p class="ltlbg_think">ã«ã™ã‚‹
  ## è¡Œé ­ã€ã§ã¯ã˜ã¾ã‚‹ã€ã€Ÿã¾ã§ã‚’<p class="ltlbg_wquote">ã«ã™ã‚‹
  ## è¡Œé ­ã€ã§ã¯ã˜ã¾ã‚‹ã€ã€ã¾ã§ã‚’<p class="ltlbg_talk2">ã«ã™ã‚‹
  ## è¡Œé ­â€•ã§ã¯ã˜ã¾ã‚‹ã€æ”¹è¡Œã¾ã§ã‚’<p class="ltlbg_dash">ã«ã™ã‚‹
  ## è¡Œé ­ï¼ã§ã¯ã˜ã¾ã‚‹ã€æ”¹è¡Œã¾ã§ã‚’<p class="ltlbg_citation">ã«ã™ã‚‹
  ## ã“ã‚Œã‚‰ã®pã‚¿ã‚°ã¯è¤‡æ•°è¡Œã«æ¸¡ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€é–‰ã˜ã‚¿ã‚°ã«<\!--ltlbg_XXX-->ã‚’ä»˜ä¸ã™ã‚‹
  cat tmp1_ltlbgtmp \
  | sed -e 's/^ã€Œ\(.\+\)ã€/<p class=\"ltlbg_talk\">\1<\/p><\!--ltlbg_talk-->/g' \
  | sed -e 's/^ï¼ˆ\(.\+\)ï¼‰/<p class=\"ltlbg_think\">\1<\/p><\!--ltlbg_think-->/g' \
  | sed -e 's/^ã€\(.\+\)ã€Ÿ/<p class=\"ltlbg_wquote\">\1<\/p><\!--ltlbg_wquote-->/g' \
  | sed -e 's/^ã€\(.\+\)ã€/<p class=\"ltlbg_talk2\">\1<\/p><\!--ltlbg_talk2-->/g' \
  | sed -e 's/^â€•\(.\+\)â€•/<p class=\"ltlbg_dash\">\1<\/p><\!--ltlbg_dash-->/g' \
  | sed -e 's/^ï¼\(.\+\)ï¼œ/<p class=\"ltlbg_citation\">\1<\/p><\!--ltlbg_citation-->/g' \
  >tmp2_ltlbgtmp

  ############################åœç‚¹å¯¾å¿œ
  ##ã€Šã€ŠåŸºåº•æ–‡å­—ã€‹ã€‹ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã‚’åŸºåº•æ–‡å­—ã¨åŒæ–‡å­—æ•°ã®ï¹…ã‚’ãµã‚‹ãƒ«ãƒ“ã¸ç½®æ›ã™ã‚‹
  ## <ruby class="ltlbg_emphasis" data-ruby="ï¹…">åŸºåº•æ–‡å­—<rt>ï¹…</rt></ruby>
  ### åœç‚¹ç”¨å¤‰æ›å…ƒæ–‡å­—åˆ—|å¤‰æ›å…ˆæ–‡å­—åˆ—ã‚’ä½œæˆã™ã‚‹
  cat tmp2_ltlbgtmp >emphasisInput_ltlbgtmp
  cat emphasisInput_ltlbgtmp \
  | grep -E -o "ã€Šã€Š[^ã€‹]+ã€‹ã€‹"  \
  | uniq \
  >tgt_ltlbgtmp

  ## ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«replaceSeed(ã€Šã€Š[^ã€‹]*ã€‹ã€‹ã§æŠ½å‡ºã—ãŸã‚‚ã®)ã®é•·ã•ãŒ0ã®å ´åˆã€å‡¦ç†ã—ãªã„
  if [ -s tgt_ltlbgtmp ]; then 

    # åœç‚¹ã®åŸºåº•æ–‡å­—åˆ—ã®ã¿ã®ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹
    # ãƒ»ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—ã®è¨˜å·ã‚’å¤–ã™
    # ãƒ»ã‚¹ãƒšãƒ¼ã‚¹é¡ã‚’ä¸€æ™‚çš„ã«å¸Œå°‘ãªé€€é¿æ–‡å­—ã¸ç½®æ›ã™ã‚‹
    cat tgt_ltlbgtmp \
    | sed -e 's/[ã€Šã€‹]//g' \
    | sed -e 's/<span class=\"ltlbg_wSp\"><\/span>/ã€¼/g' \
    | sed -e 's/<span class=\"ltlbg_sSp\"><\/span>/ã€¿/g' \
    >raw_ltlbgtmp

    # ãƒ«ãƒ“ã¨ã—ã¦æŒ¯ã‚‹ã€Œï¹…ã€ã‚’ã€rawã¨åŒã˜æ–‡å­—ã ã‘ã‚‚ã£ãŸä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚
    # [^å­—^](å›è»¢)ã€[l\[å·¦å³\]r\](å¼·åˆ¶åˆå­—)ã€^^(ç¸¦ä¸­æ¨ª)ã€~~(è‡ªå‹•ç¸¦ä¸­æ¨ª)ã¯
    # å‚ç‚¹è¦³ç‚¹ã§ã¯1æ–‡å­—ã¨ã—ã¦æ‰±ã†ã€‚
    cat raw_ltlbgtmp \
    | sed -e 's/\*\*//g' \
    | sed -e 's/ã‚›//g' \
    | sed -e 's/\[\^.\^\]/ï¹…/g' \
    | sed -e 's/\[l\[..\]r\]/ï¹…/g' \
    | sed -e 's/\^.\{1,3\}\^/ï¹…/g' \
    | sed -e 's/~.\{2\}~/ï¹…/g' \
    | sed -e 's/./ï¹…/g' \
    >emphtmp_ltlbgtmp
  
    # ä¸Šè¨˜ã§ä½œã£ãŸåŸºåº•æ–‡å­—ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ«ãƒ“æ–‡å­—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—å˜ä½ã«çµåˆã™ã‚‹
    # ãã®å¾Œã€å„è¡Œã”ã¨ã«ç½®æ›å‡¦ç†ã‚’è¡Œã„ã€
    # ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«tgtã®å„è¡Œã‚’ç½®æ›å…ƒã¨ã™ã‚‹ç½®æ›å…ˆæ–‡å­—åˆ—ã‚’ä½œæˆã™ã‚‹ã€‚
    ## â†’ç½®æ›å…ˆæ–‡å­—åˆ—
    ## ã€€å„è¡Œã”ã¨ã«ã€Œ,ã€ã®å‰ãŒåŸºåº•æ–‡å­—ã€ã€Œ,ã€ã®å¾ŒãŒãƒ«ãƒ“æ–‡å­—ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€
    ## ã€€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ãƒ«ãƒ“ã‚¿ã‚°ã®æ–‡å­—åˆ—ã‚’ä½œæˆã™ã‚‹ã€‚
    paste -d , raw_ltlbgtmp emphtmp_ltlbgtmp \
    | while read line || [ -n "${line}" ]; do 

      echo "${line##*,}" \
      | grep -E -o . \
      | sed -e 's/^/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"/' \
      | sed -e 's/$/\">/' \
      >1_ltlbgtmp

      echo "${line%%,*}" \
      | grep -E -o "(\[\^.\^\]|\^[^\^]+\^|\~[^~]{2}\~|<[^>]>[^<]+<\/>|\{[^ï½œ]\+ï½œ[^\}]\+\}|.ã‚›|.)" \
      >2_ltlbgtmp

      echo "${line##*,}" \
      | grep -E -o "." \
      | sed -e 's/^/<rt>/g' \
      | sed -e 's/$/<\/rt><\/ruby>/g' \
      >3_ltlbgtmp

      paste 1_ltlbgtmp 2_ltlbgtmp 3_ltlbgtmp \
      | sed -e 's/\t//g' \
      | sed -z 's/\n//g' \
      | sed -e 's/\//\\\//g' \
      | sed -e 's/\"/\\\"/g' \
      | sed -e 's/\[/\\\[/g' \
      | sed -e 's/\]/\\\]/g' \
      | sed -e 's/\^/\\\^/g' \
      | sed -e 's/\*/\\\*/g' \
      | sed -e 's/$/\/g'\'' \\/'

      echo ''
      done \
    >rep_ltlbgtmp

    cat tgt_ltlbgtmp \
    | sed -e 's/\//\\\//g' \
    | sed -e 's/\"/\\\"/g' \
    | sed -e 's/\[/\\\[/g' \
    | sed -e 's/\]/\\\]/g' \
    | sed -e 's/\^/\\\^/g' \
    | sed -e 's/\*/\\\*/g' \
    | sed -e 's/^/\| sed -e '\''s\//' \
    | sed -e 's/$/\//g' \
    >replaceSeed_ltlbgtmp
    
    paste replaceSeed_ltlbgtmp rep_ltlbgtmp \
    | sed -e 's/\t//g' \
    | sed -z 's/^/cat emphasisInput_ltlbgtmp \\\n/' \
    >tmp.sh
    bash  tmp.sh >tmp1_ltlbgtmp

    cat tmp1_ltlbgtmp \
    | sed -e 's/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\">ã€¼<rt>ï¹…<\/rt><\/ruby>/<span class=\"ltlbg_wSp\"><\/span>/g' \
    | sed -e 's/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\">ã€¿<rt>ï¹…<\/rt><\/ruby>/<span class=\"ltlbg_sSp\"><\/span>/g' \
    | sed -e 's/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\">\([\*\^\~]\?\)<rt>ï¹…<\/rt><\/ruby>/\1/g' \
    >tmp2_ltlbgtmp
    cat tmp2_ltlbgtmp >emphasisOutput_ltlbgtmp
  else
    cat emphasisInput_ltlbgtmp >emphasisOutput_ltlbgtmp
  fi
  cat emphasisOutput_ltlbgtmp \
  >tmp1_ltlbgtmp
  ############################åœç‚¹å¯¾å¿œ

  cat tmp1_ltlbgtmp >rubyInput_ltlbgtmp
  ############################ãƒ«ãƒ“å¯¾å¿œ
  ## {åŸºåº•æ–‡å­—|ãƒ«ãƒ“}ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã‚’<ruby class="ltlbg_ruby" data-ruby="ãƒ«ãƒ“">åŸºåº•æ–‡å­—<rt>ãƒ«ãƒ“</rt></ruby>ã¸
  ## ã¤ã„ã§ã ã‹ã‚‰|åŸºåº•æ–‡å­—ã€Šãƒ«ãƒ“ã€‹ã‚‚<ruby class="ltlbg_ruby" data-ruby="ãƒ«ãƒ“">åŸºåº•æ–‡å­—<rt>ãƒ«ãƒ“</rt></ruby>ã¸

  ## ãƒ«ãƒ“ã‚¿ã‚°ã§æŠ½å‡ºã—ãŸçµæœãŒãªã‘ã‚Œã°ã‚¹ã‚­ãƒƒãƒ—
  cat rubyInput_ltlbgtmp \
  | grep -E -o "\{[^ï½œ]+ï½œ[^}]+\}|ï½œ[^ã€Š]+ã€Š[^ã€‹]+ã€‹" \
  | uniq \
  > tgt_ltlbgtmp

  if [ -s tgt_ltlbgtmp ]; then

    ## äº‹å‰ã«ã‚¹ãƒšãƒ¼ã‚¹é¡ã‚’ä¸€æ™‚é€€é¿æ–‡å­—ã¸ã€‚
    ## ãƒ«ãƒ“ã®ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¡¨ç¾ã‚’{ï½œ}ã«çµ±ä¸€
    cat tgt_ltlbgtmp \
    | sed -e 's/<span class=\"ltlbg_wSp\"><\/span>/ã€¼/g' \
    | sed -e 's/<span class=\"ltlbg_sSp\"><\/span>/ã€¿/g' \
    | sed -e 's/ï½œ\([^ã€Š]\+\)ã€Š\([^ã€‹]\+\)ã€‹/{\1ï½œ\2}/g' \
    >rubytmp_ltlbgtmp

    ## åŸºåº•æ–‡å­—ã®é•·ã•ã‚’æŠ½å‡ºã€‚
    cat rubytmp_ltlbgtmp \
    | sed -e 's/[\{\}]//g' \
    | while read line || [ -n "${line}" ]; do 
        echo -n "${line%%ï½œ*}" \
        | sed -e 's/\*//g' \
        | sed -e 's/\[l\[[^\]\{2\}\]r\]/â– /g' \
        | sed -e 's/\[\^.\^\]/â– /g' \
        | sed -e 's/\~[^\~]\{2\}\~/â– /g' \
        | sed -e 's/\^[^\^]\{1,3\}\^/â– /g' \
        | wc -m;
      done \
    >1_ltlbgtmp

    ## ãƒ«ãƒ“æ–‡å­—ã®é•·ã•ã‚’æŠ½å‡ºã€‚
    cat rubytmp_ltlbgtmp \
    | sed -e 's/[\{\}]//g' \
    | while read line || [ -n "${line}" ]; do 
        echo -n "${line##*ï½œ}" \
        | sed -e 's/\~//g' \
        | wc -m;
      done \
    >2_ltlbgtmp

    ## æ–‡å­—æ•°ã®é–¢ä¿‚ã«å¾“ã£ã¦ä»˜ä¸ã™ã‚‹æ–‡å­—ã‚’å‡ºåŠ›ã™ã‚‹(è©²å½“ç®‡æ‰€ã‚’ç½®æ›ã™ã‚‹)ã€‚æ–‡å­—ã¯ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãªã£ã¦ã„ã‚‹
    ## 1ã¯åŸºåº•æ–‡å­—ã®æ–‡å­—æ•°ã€2ã¯ãƒ«ãƒ“ã®æ–‡å­—æ•°
    ## 
    paste -d , 1_ltlbgtmp 2_ltlbgtmp \
    | sed -e 's/\([0-9]\+\)\,\([0-9]\+\)/ \
      i=$((\1 * 2)); \
      if [ ${i} -ge \2 ] \&\& [ \1 -lt \2 ]; then \
        echo '"'_center'"'; \
      elif [ \1 -eq \2 ]; then \
        echo '"'_mono'"'; \
      elif [ ${i} -le \2 ] \|\| [ \1 -lt \2 ]; then \
        echo '"'_long'"'; \
      else echo '"'_short'"'; \
      fi/g' \
      >tmp.sh
    bash tmp.sh >ins_ltlbgtmp
    
    cat rubytmp_ltlbgtmp \
    | sed -e 's/.\+/\| sed -e '\''s\//g' \
    >head_ltlbgtmp

    cat tgt_ltlbgtmp \
    | sed -e 's/\//\\\//g' \
    | sed -e 's/\[/\\\[/g' \
    | sed -e 's/\]/\\\]/g' \
    | sed -e 's/\^/\\\^/g' \
    | sed -e 's/\~/\\\~/g' \
    | sed -e 's/\*/\\\*/g' \
    | sed -e 's/\"/\\\"/g' \
    >tgtStr_ltlbgtmp

    cat rubytmp_ltlbgtmp \
    | sed -e 's/.\+/\//g' \
    >slash_ltlbgtmp

    cat rubytmp_ltlbgtmp \
    | sed -e 's/.\+/<ruby class=\"ltlbg_ruby\" data-ruby/g' \
    >rubyTag1_ltlbgtmp

    cat ins_ltlbgtmp \
    | sed -e 's/$/=\\\"/g' \
    >rubyType_ltlbgtmp

    cat rubytmp_ltlbgtmp \
    | sed -e 's/[\{\}]//g' \
    | sed -e 's/^[^ï½œ]\+ï½œ//g' \
    | sed -e 's/\~\([a-zA-Z0-9!?]\{2\}\)\~/\1/g' \
    | sed -e 's/\//\\\//g' \
    | sed -e 's/\[/\\\[/g' \
    | sed -e 's/\]/\\\]/g' \
    | sed -e 's/\^/\\\^/g' \
    | sed -e 's/\*/\\\*/g' \
    | sed -e 's/\"/\\\"/g' \
    | sed -e 's/ã€¼/ã€€/g' \
    | sed -e 's/ã€¿/ /g' \
    >rubyStr_ltlbgtmp

    cat rubytmp_ltlbgtmp \
    | sed -e 's/.\+/\\\">/g' \
    >rubyTag2_ltlbgtmp

    cat rubytmp_ltlbgtmp \
    | sed -e 's/[\{\}]//g' \
    | sed -e 's/ï½œ.\+$//g' \
    | sed -e 's/\//\\\//g' \
    | sed -e 's/\[/\\\[/g' \
    | sed -e 's/\]/\\\]/g' \
    | sed -e 's/\^/\\\^/g' \
    | sed -e 's/\~/\\\~/g' \
    | sed -e 's/\*/\\\*/g' \
    | sed -e 's/\"/\\\"/g' \
    | sed -e 's/$/<rt>/g' \
    >rubyBase_ltlbgtmp

    cat rubytmp_ltlbgtmp \
    | sed -e 's/.\+/<\\\/rt><\\\/ruby>/g' \
    >rubyTag3_ltlbgtmp

    #     sed/ {bï½œr} /
    paste head_ltlbgtmp tgtStr_ltlbgtmp slash_ltlbgtmp >RepStr1_ltlbgtmp

    #     <ruby... mono..=" STR     ">
    paste rubyTag1_ltlbgtmp rubyType_ltlbgtmp rubyStr_ltlbgtmp rubyTag2_ltlbgtmp >RepStr2_ltlbgtmp

    #     Base<rt> Ruby    </rt></ruby>
    paste rubyBase_ltlbgtmp rubyStr_ltlbgtmp rubyTag3_ltlbgtmp >RepStr3_ltlbgtmp

    # sedæ–‡ã‚’tmp.shã¸
    paste RepStr1_ltlbgtmp RepStr2_ltlbgtmp RepStr3_ltlbgtmp \
    | sed -e 's/\t//g' \
    | sed -e 's/$/\/g'\'' \\/g' \
    | sed -z 's/^/cat rubyInput_ltlbgtmp \\\n/g' \
    >tmp.sh
    bash tmp.sh >rubyOutput_ltlbgtmp

    cat rubyOutput_ltlbgtmp >monorubyInput_ltlbgtmp
    ## data-ruby_monoã®ãƒ«ãƒ“ã‚¿ã‚°ã‚’ã€ãƒ¢ãƒãƒ«ãƒ“ã«å¤‰æ›ã™ã‚‹
    ## å‰æ®µã§data-ruby_monoã‚’ä»˜ä¸ã—ãŸã‚‚ã®ã‚’å¯¾è±¡ã«ã€ãƒ¢ãƒãƒ«ãƒ“ç½®æ›ã™ã‚‹ä¸€æ™‚shã‚’ä½œæˆã—ã¦å®Ÿè¡Œã™ã‚‹ã€‚
    ## å¾Œç¶šã«ã¯å½“è©²shã®å‡ºåŠ›ã‚’ã¤ãªã’ã‚‹ã€‚ãƒ¢ãƒãƒ«ãƒ“ã«ã¯shortãŒæŒ‡å®šã•ã‚Œã‚‹
    cat monorubyInput_ltlbgtmp \
    | grep -o '<ruby class=\"ltlbg_ruby\" data-ruby_mono=\"[^>]\+\">[^<]\+<rt>[^<]\+<\/rt><\/ruby>' \
    | uniq \
    >org_ltlbgtmp

    ## ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«org(ãƒ¢ãƒãƒ«ãƒ“ã‚¿ã‚°ã§æŠ½å‡ºã—ãŸçµæœ)ã®é•·ã•ãŒ0ã®ã¨ãã€å‡¦ç†ã—ãªã„
    if [ -s org_ltlbgtmp ] ; then

        cat org_ltlbgtmp \
      | sed -e 's/\//\\\//g' \
      | sed -e 's/\[/\\\[/g' \
      | sed -e 's/\]/\\\]/g' \
      | sed -e 's/\^/\\\^/g' \
      | sed -e 's/\~/\\\~/g' \
      | sed -e 's/\*/\\\*/g' \
      | sed -e 's/\"/\\\"/g' \
      | sed -e 's/^/\| sed -e '\''s\//g' \
      >tgt_ltlbgtmp

      cat org_ltlbgtmp \
      | sed -e 's/<ruby class=\"ltlbg_ruby\" data-ruby_mono=\"[^\"]\+">\([^<]\+\)<rt>\([^<]\+\)<\/rt><\/ruby>/\1,\2/g' \
      | uniq \
      | while read line || [ -n "${line}" ]; do \
          echo "${line##*,}" \
          | grep -o . \
          | sed -e 's/^/<ruby class=\"ltlbg_ruby\" data-ruby_center=\"/g' \
          | sed -e 's/$/\">/g' \
          | sed -e 's/\//\\\//g' \
          | sed -e 's/\"/\\\"/g' \
          >rubyStr_ltlbgtmp

          echo "${line%%,*}" \
          | grep -E -o "\[l\[[^\]{2}\]r\]|\[\^.\^\]|~[^~]{2}~|\^[^\^]{1,3}\^|\*\*.|.\*\*|." \
          | sed -e 's/\//\\\//g' \
          | sed -e 's/\[/\\\[/g' \
          | sed -e 's/\]/\\\]/g' \
          | sed -e 's/\^/\\\^/g' \
          | sed -e 's/\~/\\\~/g' \
          | sed -e 's/\*/\\\*/g' \
          | sed -e 's/\"/\\\"/g' \
          >rubyBase_ltlbgtmp
          
          echo "${line##*,}" \
          | grep -E -o . \
          | sed -e 's/^/<rt>/' \
          | sed -e 's/$/<\/rt><\/ruby>/' \
          | sed -e 's/\//\\\//g' \
          | sed -e 's/\"/\\\"/g' \
          >rubyStr2_ltlbgtmp
          
          paste rubyStr_ltlbgtmp rubyBase_ltlbgtmp rubyStr2_ltlbgtmp \
          | sed -e 's/\t//g' \
          | sed -z 's/\n//g' \
          | sed -e 's/$/\/g'\'' \\/' \
          | sed -e 's/<ruby class=\\\"ltlbg_ruby\\\" data-ruby_center=\\\"\(.\)\\\">\\\*\\\*\([^\*]\)<rt>.<\\\/rt><\\\/ruby>/\\\*\\\*<ruby class=\\\"ltlbg_ruby\\\" data-ruby_center=\\\"\1\\\">\2<rt>\1<\\\/rt><\\\/ruby>/g' \
          | sed -e 's/<ruby class=\\\"ltlbg_ruby\\\" data-ruby_center=\\\"\(.\)\\\">\([^\*]\)\\\*\\\*<rt>.<\\\/rt><\\\/ruby>/<ruby class=\\\"ltlbg_ruby\\\" data-ruby_center=\\\"\1\\\">\2<rt>\1<\\\/rt><\\\/ruby>\\\*\\\*/g' \

          echo ''
        done \
      >rep_ltlbgtmp

      paste tgt_ltlbgtmp rep_ltlbgtmp \
      | sed -e 's/\t/\//g' \
      | sed -z 's/^/cat monorubyInput_ltlbgtmp \\\n/' \
      >tmp.sh

      bash tmp.sh >monorubyOutput_ltlbgtmp

    else
      cat monorubyInput_ltlbgtmp >monorubyOutput_ltlbgtmp
    fi

    ## ã“ã“ã§data-ruby_monoãŒç½®æ›ã•ã‚Œã¦ã„ãªã„å ´åˆã€å†…éƒ¨ã«ã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãªã©ã®ç†ç”±ã§å¤‰æ›ãŒã†ã¾ãã§ãã¦ã„ãªã„ã€‚
    ## data-ruby_centerã¸ç¸®é€€å¤‰æ›ã™ã‚‹ã€‚
    cat monorubyOutput_ltlbgtmp \
    | sed -e 's/<ruby class=\"ltlbg_ruby\" data-ruby_mono=\"\([^"]\{2,\}\)\">/<ruby class=\"ltlbg_ruby\" data-ruby_center=\"\1\">/g' \
    >rubyOutput_ltlbgtmp

  else
    cat rubyInput_ltlbgtmp >rubyOutput_ltlbgtmp
  fi

  #################################ãƒ«ãƒ“å¯¾å¿œã“ã“ã¾ã§
  cat rubyOutput_ltlbgtmp >tmp1_ltlbgtmp

  # ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—ã®ãªã„è‡ªå‹•ç½®æ›
  ## ã€Œ;ã€ã€Œï¼›ã€ã«<span ltlbg_semicolon>ã‚’é©ç”¨ã™ã‚‹
  ## ã€Œ:ã€ã€Œï¼šã€ã«<span ltlbg_colon>ã‚’é©ç”¨ã™ã‚‹
  ## â€•ã‚’<br class="ltlbg_wSize">â€•</span>ã«
  cat tmp1_ltlbgtmp \
  | sed -e 's/\(ï¼›\|\;\)/<span class=\"ltlbg_semicolon\">ï¼›<\/span>/g' \
  | sed -e 's/\(ï¼š\|\:\)/<span class=\"ltlbg_colon\">ï¼š<\/span>/g' \
  | sed -e 's/â€•/<span class=\"ltlbg_wSize\">â€•<\/span>/g' \
  >tmp2_ltlbgtmp

  #ã‚¿ã‚°ã§æ‹¬ã‚‹ã‚¿ã‚¤ãƒ—ã®ä¿®é£¾_1æ–‡å­—
  ## [-å­—-]ã‚’<span class="ltlbg_wdfix">ã¸ã€‚ç‰¹å®šã®æ–‡å­—ã«ã¤ã„ã¦ã¯ltlbg_wSpã‚’æŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚‹ã®ã§ãã‚Œã‚‚è€ƒæ…®ã—ãŸç½®æ›ã‚’è¡Œã†
  ## [^å­—^]ã‚’<span class="ltlbg_rotate">ã¸ã€‚
  ## [l[åæ—]r]ã‚’<span class="ltlbg_forcedGouji1/2">ã¸
  cat tmp2_ltlbgtmp \
  | sed -e 's/\[\-\(.\)\-\]/<span class=\"ltlbg_wdfix\">\1<\/span>/g' \
  | sed -e 's/\[\^\(.\)\^\]/<span class=\"ltlbg_rotate\">\1<\/span>/g' \
  | sed -e 's/\[l\[\(.\)\(.\)\]r\]/<span class=\"ltlbg_forceGouji1\">\1<\/span><span class=\"ltlbg_forceGouji2\">\2<\/span>/g' \
  >tmp1_ltlbgtmp

  #ã‚¿ã‚°ã§æ‹¬ã‚‹ã‚¿ã‚¤ãƒ—ã®ä¿®é£¾_è¤‡æ•°æ–‡å­—
  ## ~ã¨~ã«å›²ã¾ã‚ŒãŸ2æ–‡å­—ã®ç¯„å›²ã‚’<br class="ltlbg_tcyA">ç¸¦ä¸­æ¨ª</span>ã«
  ## **å¤ªå­—**ã‚’<br class="ltlbg_wSize">â€•</span>ã«
  ## ^ã¨^ã«å›²ã¾ã‚ŒãŸ1ã€œ3æ–‡å­—ã®ç¯„å›²ã‚’ã€<br class="ltlbg_tcyM">ç¸¦ä¸­æ¨ª</span>ã«ã€‚[^å­—^]ã¯é£Ÿã‚ãªã„ã‚ˆã†ã«
  cat tmp1_ltlbgtmp \
  | sed -e 's/~\([a-zA-Z0-9!?]\{2\}\)~/<span class=\"ltlbg_tcyA\">\1<\/span>/g' \
  | sed -e 's/\*\*\([^\*]\+\)\*\*/<span class=\"ltlbg_bold\">\1<\/span>/g' \
  | sed -e 's/\^<span class="ltlbg_sSp"><\/span>\(..\)\^/^ã€¿\1^/g' \
  | sed -e 's/\^\(.\)<span class=\"ltlbg_sSp\"><\/span>\(.\)\^/^\1ã€¿\2^/g' \
  | sed -e 's/\(..\)\^<span class=\"ltlbg_sSp\"><\/span>\^/^\1ã€¿^/g' \
  | sed -e 's/\^\([^\^]\{1,3\}\)\^/<span class=\"ltlbg_tcyM\">\1<\/span>/g' \
  > tmp2_ltlbgtmp

  #ã‚¿ã‚°ã«ç½®æ›ã™ã‚‹ã‚¿ã‚¤ãƒ—ã®å¤‰æ›
  ## [newpage]ã‚’ã€<br class="ltlbg_newpage">ã«
  ## ---ã‚’<span class="ltlbg_hr">ã¸ã€‚ä½†ã—ç›´å¾Œã®æ”¹è¡Œã¯é™¤å»
  ## ï¼ï¼¼ã‚‚ã—ãã¯ã€±ã‚’ã€<span class="ltlbg_odori1"></span><span class="ltlbg_odori2"></span>ã«ã€‚ãƒ¢ãƒãƒ«ãƒ“åŒ–ã—ã¦ã„ã‚‹ã‚‚ã®ã‚‚å¯¾å¿œ
  ## ã€Œã‚›ã€ã‚’ã€<span class="ltlbg_dakuten">ã«å¤‰æ›ã™ã‚‹ã€‚ å¾Œã‚ã‚¹ãƒšãƒ¼ã‚¹æŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã‚’è€ƒæ…®ã™ã‚‹
  cat tmp2_ltlbgtmp \
  | sed -e '/\[newpage\]/c <div class="ltlbg_newpage"></div>' \
  | sed -e 's/-\{3,\}/<hr class=\"ltlbg_hr\">/g' \
  | sed -e 's/<hr class=\"ltlbg_hr\"><br class=\"ltlbg_br\">/<hr class=\"ltlbg_hr\">/g' \
  | sed -e 's/ï¼ï¼¼/<span class=\"ltlbg_odori1\"><\/span><span class=\"ltlbg_odori2\"><\/span>/g' \
  | sed -e 's/ã€±/<span class=\"ltlbg_odori1\"><\/span><span class=\"ltlbg_odori2\"><\/span>/g' \
  | sed -e 's/<ruby class=\"ltlbg_ruby\" data-ruby_center=\"\([^\"]\+\)\">ï¼<rt>[^\<]\+<\/rt><\/ruby><ruby class=\"ltlbg_ruby\" data-ruby_center=\"\([^\"]\+\)\">ï¼¼<rt>[^\<]\+<\/rt><\/ruby>/<ruby class=\"ltlbg_ruby\" data-ruby_center=\"\1\"><span class=\"ltlbg_odori1\"><\/span><rt>\1<\/rt><\/ruby><ruby class=\"ltlbg_ruby\" data-ruby_center=\"\2\"><span class=\"ltlbg_odori2\"><\/span><rt>\2<\/rt><\/ruby>/g' \
  | sed -e 's/<ruby class=\"ltlbg_ruby\" data-ruby_center=\"\([^\"]\+\)\">ã€³<rt>[^\<]\+<\/rt><\/ruby><ruby class=\"ltlbg_ruby\" data-ruby_center=\"\([^\"]\+\)\">ã€µ<rt>[^\<]\+<\/rt><\/ruby>/<ruby class=\"ltlbg_ruby\" data-ruby_center=\"\1\"><span class=\"ltlbg_odori1\"><\/span><rt>\1<\/rt><\/ruby><ruby class=\"ltlbg_ruby\" data-ruby_center=\"\2\"><span class=\"ltlbg_odori2\"><\/span><rt>\2<\/rt><\/ruby>/g' \
  | sed -e 's/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\">ï¼<rt>ï¹…<\/rt><\/ruby><ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\">ï¼¼<rt>ï¹…<\/rt><\/ruby>/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\"><span class=\"ltlbg_odori1\"><\/span><rt>ï¹…<\/rt><\/ruby><ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\"><span class=\"ltlbg_odori2\"><\/span><rt>ï¹…<\/rt><\/ruby>/g' \
  | sed -e 's/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\">ã€³<rt>ï¹…<\/rt><\/ruby><ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\">ã€µ<rt>ï¹…<\/rt><\/ruby>/<ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\"><span class=\"ltlbg_odori1\"><\/span><rt>ï¹…<\/rt><\/ruby><ruby class=\"ltlbg_emphasis\" data-emphasis=\"ï¹…\"><span class=\"ltlbg_odori2\"><\/span><rt>ï¹…<\/rt><\/ruby>/g' \
  | sed -e 's/\([ï¼ï¼Ÿâ™¥â™ªâ˜†]\)<span class="ltlbg_wSp"><\/span>ã‚›/<span class="ltlbg_dakuten">\1<\/span><span class="ltlbg_wSp"><\/span>/g' \
  | sed -e 's/\(.\)ã‚›/<span class="ltlbg_dakuten">\1<\/span>/g' \
  >tmp1_ltlbgtmp

  ##########################################################################################
  # é€€é¿çš„å¾©æ—§ï¼šç½®æ›å¯¾è±¡æ–‡å­—ã«æŠµè§¦ã™ã‚‹ãŒã€ç‰¹ä¾‹çš„ã«ç½®æ›ã—ãŸããªã„ç®‡æ‰€ã®ã¿å¾©æ—§ã™ã‚‹
  # ã‚¹ãƒšã‚·ãƒ£ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ï¼šã‚¿ã‚°é‡è¤‡é©ç”¨ãªã©ã§ä¸Šè¿°ã®ç½®æ›ã§é©å¿œã§ããªã„ã‚‚ã®ã‚’å€‹åˆ¥å¯¾å¿œã™ã‚‹
  ##########################################################################################
  ## chapter:XXXX ã«ã¯è‹±æ•°å­—ãŒä½¿ãˆã‚‹ã®ã§tcyAã‚¿ã‚°ã®å½“ã¦è¾¼ã¿ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚ãã‚Œã‚’å‰Šé™¤ã™ã‚‹
  ## ã“ã“ã§ã®å¾©æ—§ã¯æƒ³å®šå¤–ã«å£Šã‚Œã¦å½“ã¦è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ãŒå¯¾è±¡ãªã®ã§ã€é™¤å»ç½®æ›ã¯ã»ã¼å€‹åˆ¥å¯¾å¿œ
  #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
  cat tmp1_ltlbgtmp \
  | sed -e 's/id="\(.*\)<span class="ltlbg_tcyA[^>]\+">\(.*\)<\/span>\(.*\)>/id="\1\2\3">/g' \
  >tmp2_ltlbgtmp

  ## ç‰¹æ®Šæ–‡å­—ã®å¾©æ—§
  #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
  cat tmp2_ltlbgtmp \
  | sed -e 's/ï¼†ï½ï½ï½/\&amp;/g' \
  | sed -e 's/ï¼†ï½Œï½”/\&lt;/g' \
  | sed -e 's/ï¼†ï½‡ï½”/\&gt;/g' \
  | sed -e 's/ï¼†ï¼ƒï¼“ï¼™/\&#39;/g' \
  | sed -e 's/ï¼†ï½…ï½ï½“ï½/\&emsp;/g' \
  | sed -e 's/ï¼†ï½ï½‚ï½“ï½/\&nbsp;/g' \
  | sed -e 's/ï¼†ï½‘ï½•ï½ï½”/\&quot;/g' \
  | sed -e 's/ï¼†ï¼ƒï¼ï¼”ï¼—/\&#047;/g' \
  | sed -e 's/ï¼†ï¼ƒï¼ï¼™ï¼’/\&#092;/g' \
  | sed -e 's/ã€¿/<span class="ltlbg_sSp"><\/span>/g' \
  | sed -e 's/ã€¼/<span class="ltlbg_wSp"><\/span>/g' \
  | sed -e 's/style="page sukebe"/style="page: sukebe;"/g' \
  | sed -z 's/\n\n/\n/g' \
  >tmp_converted_content_ltlbgtmp

  cp ../é››å½¢.html tmp_template_ltlbgtmp
  sed -i 's/{{LITTLEBUG_CONTENT_PLACEHOLDER}}/TEMP_MARKER_FOR_CONTENT/' tmp_template_ltlbgtmp
  awk '
  /TEMP_MARKER_FOR_CONTENT/ {
    while ((getline line < "tmp_converted_content_ltlbgtmp") > 0) {
      print line
    }
    close("tmp_converted_content_ltlbgtmp")
    next
  }
  { print }
  ' tmp_template_ltlbgtmp >${destFile}
  rm tmp_template_ltlbgtmp

  #>tmp2_ltlbgtmp
  ##########################################################################################
  # å…ˆé ­ã«littlebugXXX.cssèª­ã¿è¾¼ã‚€ã‚ˆã†è¿½è¨˜ã™ã‚‹
  ##########################################################################################
  #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
  #cat tmp1_ltlbgtmp \
  #| sed -z 's/^/<link rel=\"stylesheet\" href=\"\.\.\/css\/littlebugI\.css">\n/' \
  #| sed -z 's/^/<link rel=\"stylesheet\" href=\"\.\.\/css\/littlebugTD\.css">\n/' \
  #| sed -z 's/^/<\!--\<link rel=\"stylesheet\" href=\"\.\.\/css\/littlebugRL\.css">-->\n/' \
  #| sed -z 's/^/<link rel=\"stylesheet\" href=\"\.\.\/css\/littlebugU\.css">\n/' \
  #| sed -z 's/^/<link rel=\"preconnect\" href=\"https:\/\/fonts\.googleapis\.com\">\n/' \
  #| sed -z 's/^/<link rel=\"preconnect\" href=\"https:\/\/fonts\.gstatic\.com\" crossorigin>\n/' \
  #| sed -z 's/^/<link href=\"https:\/\/fonts\.googleapis\.com\/css2\?family=Noto\+Serif\+JP:wght\@300\&display=swap\" rel=\"stylesheet">\n/' \
  #>${destFile}

  echo "âœ¨ "${destFile}"ã‚’å‡ºåŠ›ã—ã¾ã—ãŸ[htmlåŒ–]"

elif [ "${convMode}" = '-h2t' ] ; then
  ## htmlâ†’txt ############################################################################################

  destFile=${tgtFile_AfterCD/".html"/"_removed.txt"} #å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã™ã‚‹
  touch ${destFile}                          #å‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ

  ## littlebugXX.cssã®èª­ã¿è¾¼ã¿ã‚’é™¤å»ã™ã‚‹
  cat ${tgtFile_AfterCD} \
  | sed -z 's/<link rel=\"stylesheet\" href=\".\+littlebug.\+css\">//' \
  | sed -z 's/<link rel=\"preconnect\" href=\"https:\/\/fonts\.googleapis\.com\">\n//' \
  | sed -z 's/<link rel=\"preconnect\" href=\"https:\/\/fonts\.gstatic\.com\" crossorigin>\n//' \
  | sed -z 's/<link href=\"https:\/\/fonts\.googleapis\.com\/css2\?family=Noto\+Serif\+JP:wght\@300\&display=swap\" rel=\"stylesheet">\n//' \
  >tmp1_ltlbgtmp
  
  ############################################################################################
  #å…¥ã‚Œå­æ§‹é€ ã«ãªã‚Šã†ã‚‹ã‚¿ã‚°ã®å¾©æ—§1ã€‚å¤–å´ã€‚ä¿®é£¾ã¯æœ€å¤§3ãªã®ã§ã€å¾©æ—§å‡¦ç†ã‚’3å›åå¾©ã™ã‚‹
  ############################################################################################
  for i in $(seq 0 2); do
    ############################################################################################
    #å…¥ã‚Œå­æ§‹é€ ã«ãªã‚Šã†ã‚‹ã‚¿ã‚°ã®å¾©æ—§2ã€‚å†…å´ã€‚ä¿®é£¾ã¯æœ€å¤§3ãªã®ã§ã€å¾©æ—§å‡¦ç†ã‚’3å›åå¾©ã™ã‚‹
    ############################################################################################
    for i in $(seq 0 2); do
      ## ç« åŒºåˆ‡ã‚Šã‚’[chapter:XXXX]ã«
      ### é–‰ã˜ã‚¿ã‚°</section><!--ltlbg_section-->ã‚’é™¤å»
      ### <section class="ltlbg_section" id="XXX">ã‚’[chapter:]ã¸
      cat tmp1_ltlbgtmp \
      | sed -e 's/<\/section><!--ltlbg_section-->//g' \
      | sed -e 's/<section class="ltlbg_section">/[chapter]/g' \
      | sed -e 's/<section class="ltlbg_section" id="\([^"]\+\)">/[chapter:\1]/g' \
      | sed -e 's/\[chapter:\]/\[chapter\]/g' \
      >tmp2_ltlbgtmp

      ## é–‰ã˜pã‚¿ã‚°ã‚’æ¶ˆã—ã€pã‚¿ã‚°ã‚’å…¨è§’ç©ºç™½ã¸ç½®æ›ã™ã‚‹
      ## å…¨è§’ç©ºç™½ç›´å¾Œã®æ”¹è¡Œã¯å‰Šé™¤ã™ã‚‹(å…ƒã®pã‚¿ã‚°ãŒç›´å¾Œã«æ”¹è¡Œã—ã¦ã„ã‚‹ãŸã‚)
      cat tmp2_ltlbgtmp \
      | sed -e 's/<\/p><!--ltlbg_p-->//g' \
      | sed -e 's/<p class="ltlbg_p">/<span class="ltlbg_wSp"><\/span>/g' \
      | sed -z 's/<span class="ltlbg_wSp"><\/span>\n<p class="ltlbg_talk">/\n<p class="ltlbg_talk">/g' \
      >tmp1_ltlbgtmp

      ## æ‹¬å¼§é¡ã‚’å¾©æ—§
      cat tmp1_ltlbgtmp \
      | sed -e 's/<\/p><!--ltlbg_talk-->/ã€/g' \
      | sed -e 's/<\/p><!--ltlbg_talk2-->/ã€/g' \
      | sed -e 's/<\/p><!--ltlbg_think-->/ï¼‰/g' \
      | sed -e 's/<\/p><!--ltlbg_wquote-->/ã€Ÿ/g' \
      | sed -e 's/<\/p><!--ltlbg_dash-->//g' \
      | sed -e 's/<\/p><!--ltlbg_citation-->//g' \
      | sed -e 's/<p class="ltlbg_talk">/ã€Œ/g' \
      | sed -e 's/<p class="ltlbg_talk2">/ã€/g' \
      | sed -e 's/<p class="ltlbg_think">/ï¼ˆ/g' \
      | sed -e 's/<p class="ltlbg_wquote">/ã€/g' \
      | sed -e 's/<p class="ltlbg_dash">/â€•â€•/g' \
      | sed -e 's/<p class="ltlbg_citation">/ï¼/g' \
      >tmp2_ltlbgtmp

      ## ç¸¦ä¸­æ¨ªã¨æ¨ªå¹…ä¿®æ­£ã‚’é™¤å»
      cat tmp2_ltlbgtmp \
      | sed -e 's/<span class=\"ltlbg_tcyA\">\([^<]\{2\}\)<\/span>/\1/g' \
      | sed -e 's/<span class=\"ltlbg_wdfix\">\([^<]\)<\/span>/\1/g' \
      >tmp1_ltlbgtmp

      ## ã‚³ãƒ­ãƒ³ã¨ã‚»ãƒŸã‚³ãƒ­ãƒ³ã‚’å¾©æ—§
      cat tmp1_ltlbgtmp \
      | sed -e 's/<span class="ltlbg_semicolon">ï¼›<\/span>/ï¼›/g' \
      | sed -e 's/<span class="ltlbg_colon">ï¼š<\/span>/ï¼š/g' \
      >tmp2_ltlbgtmp

      ## æ‹¬å¼§é¡ã®æ“¬ä¼¼æ®µè½è¨˜å·ã‚’é™¤å»
      cat tmp2_ltlbgtmp \
      | sed -e 's/<div class="ltlbg_div_brctGrp">//g' \
      | sed -e 's/<\/div><\!--ltlbg_div_brctGrp-->//g' \
      >tmp1_ltlbgtmp

      ## <span class="ltlbg_dakuten">ã‚’ã€Œã‚›ã€ã«å¾©æ—§
      ## <span class="ltlbg_tcyM">XX</span>ã‚’å¾©æ—§
      ## <span class="ltlbg_wSize">å­—</span>ã‚’å¾©æ—§
      ## <span class="ltlbg_odori1"></span><span class="ltlbg_odori2"></span>ã‚’å¾©æ—§
      cat tmp1_ltlbgtmp \
      | sed -e 's/<span class=\"ltlbg_dakuten\">\(.\)<\/span>/\1ã‚›/g' \
      | sed -e 's/<span class=\"ltlbg_tcyM\">\([^<]\{1,3\}\)<\/span>/^\1^/g' \
      | sed -e 's/<span class=\"ltlbg_wSize\">\(.\)<\/span>/\1\1/g' \
      | sed -e 's/<span class=\"ltlbg_odori1\"><\/span>/ï¼/g' \
      | sed -e 's/<span class=\"ltlbg_odori2\"><\/span>/ï¼¼/g' \
      >tmp2_ltlbgtmp

      ## å¼·åˆ¶åˆå­—<span class="ltlbg_forceGouji1">ã€<span class="ltlbg_forceGouji2">ã‚’[l[]r]ã¸å¾©æ—§
      cat tmp2_ltlbgtmp \
      | sed -e 's/<span class=\"ltlbg_forceGouji1\">\(.\)<\/span><span class=\"ltlbg_forceGouji2\">\(.\)<\/span>/[l[\1\2]r]/g' \
      >tmp1_ltlbgtmp

      ## å›è»¢æŒ‡å®š<span class="ltlbg_rotate"></span>ã‚’[^å­—^]ã¸å¾©æ—§
      ## å¤ªå­—æŒ‡å®š<span class="ltlbg_bold"></span>ã‚’**å­—**ã¸å¾©æ—§
      cat tmp1_ltlbgtmp \
      | sed -e 's/<span class=\"ltlbg_rotate\">\(.\)<\/span>/\[\^\1\^\]/g' \
      | sed -e 's/<span class=\"ltlbg_bold\">\([^<]\+\)<\/span>/\*\*\1\*\*/g' \
      >tmp2_ltlbgtmp

      ## <h2 class="ltlbg_sectionName">\1<\/h2>ã‚’è¡Œé ­â—†ã¸
      ## <hr class="ltlbg_hr">ã‚’---ã¸ã€‚
      cat tmp2_ltlbgtmp \
      | sed -e 's/<h2 class=\"ltlbg_sectionName\">\([^<]\+\)<\/h2>/\1/g' \
      | sed -e 's/<hr class=\"ltlbg_hr\">/---/g' \
      >tmp1_ltlbgtmp

      ## ãƒ¢ãƒãƒ«ãƒ“ã‚’å¾©æ—§
      cat tmp1_ltlbgtmp >tmp2_ltlbgtmp
      #3å›ç¹°ã‚Šè¿”ã™ã®ã§ãƒ«ãƒ¼ãƒ—æœ«å°¾ã§å‡ºåŠ›ã—ã¦ã„ã‚‹ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é–‹å§‹ã•ã‚Œã‚‹ã‚ˆã†èª¿æ•´ã™ã‚‹
      cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
    done

    ############################################################################################
    #è¤‡æ•°å›ã®ç½®æ›ã‚’å¿…è¦ã¨ã—ãªã„(é€”ä¸­ã§æˆ»ã‚‹ã¨ä¸éƒ½åˆã®ã‚ã‚‹)å¾©æ—§
    ############################################################################################
    ## ã€Œ&lt;ã€  ã‚’ã€Œ<ã€(åŠè§’)ã¸å¤‰æ›
    ## ã€Œ&gt;ã€  ã‚’ã€Œ>ã€(åŠè§’)ã¸å¤‰æ›
    ## ã€Œ&amp;ã€ ã‚’ã€Œ&ã€(åŠè§’)ã¸å¤‰æ›
    ## ã€Œ&quot;ã€ã‚’ã€Œ'ã€(åŠè§’)ã¸å¤‰æ›
    ## ã€Œ&#39;ã€ ã‚’ã€Œ"ã€(åŠè§’)ã¸å¤‰æ›
    cat tmp2_ltlbgtmp \
    | sed -e 's/&amp;/\&/g' \
    | sed -e 's/&lt;/</g' \
    | sed -e 's/&gt;/>/g' \
    | sed -e 's/&quot;/'\''/g' \
    | sed -e 's/&#39;/\"/g' \
    >tmp1_ltlbgtmp

    ## ã“ã“ã¾ã§ç”Ÿã˜ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ç©ºè¡Œã¯å‰¯ç”£ç‰©ãªã®ã§å‰Šé™¤
    ## ãã®ä¸Šã§ã€<br class="ltlbg_br">ã€<br class="ltlbg_blankline">ã‚’å‰Šé™¤
    cat tmp1_ltlbgtmp \
    | sed -z 's/^\n//g' \
    | sed -e 's/<br class=\"ltlbg_br\">//g' \
    | sed -e 's/^<br class=\"ltlbg_blankline\">//g' \
    | sed -e 's/<span class=\"ltlbg_wSp\"><\/span>/ã€€/g' \
    | sed -e 's/<span class=\"ltlbg_sSp\"><\/span>/ /g' \
    | sed -z 's/ã€€\n/\n/g' \
    >tmp2_ltlbgtmp

    #################################################################################
    #ãƒ«ãƒ“ã¨åœç‚¹ã®å¾©æ—§ã¯æœ€å¾Œã€‚åœç‚¹ã¨ãƒ¢ãƒãƒ«ãƒ“ã¯ç‰¹æ®Šãªæˆ»ã—ä½œæ¥­ã‚’è¦ã™ã‚‹ã€‚
    #################################################################################
    ## ãƒ¢ãƒãƒ«ãƒ“ä»¥å¤–ã®<span class="ltlbg_ruby" data-ruby_XXX="XXX"></span>ã‚’å¾©æ—§
    cat tmp2_ltlbgtmp \
    | sed -e 's/<ruby class="ltlbg_ruby" data-ruby_[^=]\+="\([^"]\+\)">\([^<]\+\)<rt>[^<]\+<\/rt><\/ruby>/{\2ï½œ\1}/g' \
    >tmp1_ltlbgtmp

    #é †åºã®å…¥ã‚Œæ›¿ãˆ
    cat tmp1_ltlbgtmp \
    | sed -e 's/\*\*{\([^ï½œ]\+\)ï½œ\([^\}]\+\)}\*\*/{\*\*\1\*\*ï½œ\2}/g' \
    > tmp2_ltlbgtmp

    ## åœç‚¹ã‚¿ã‚°ã‚’ã€Šã€ŠåŸºåº•æ–‡å­—ã€‹ã€‹ã¸å¾©æ—§ã™ã‚‹
    ## <ruby class=\"ltlbg_emphasis\" data-ruby_emphasis=\"[^]]\">ã€œã§æŠ½å‡ºã—ãŸã‚‚ã®ã‚’ç½®æ›å…ƒã¨ã™ã‚‹ã€‚
    ## åŸºåº•æ–‡å­—ã ã‘ã‚’æŒã¤ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã€ãƒ«ãƒ“ã ã‘ã‚’æŒã¤ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ç½®æ›å…ˆã¨ã™ã‚‹ã€‚
    ## ç½®æ›æ©Ÿèƒ½ã‚’æŒã£ãŸä¸­é–“ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€å®Ÿè¡Œã™ã‚‹ã€‚
    cat tmp2_ltlbgtmp \
    | sed -e 's/<ruby class=\"ltlbg_emphasis\" data-emphasis=\".\">\([^<]\+\)<rt>.<\/rt><\/ruby>/ã€Šã€Š\1ã€‹ã€‹/g' \
    >tmp1_ltlbgtmp

    #3å›ç¹°ã‚Šè¿”ã™ã®ã§ãƒ«ãƒ¼ãƒ—æœ«å°¾ã§å‡ºåŠ›ã—ã¦ã„ã‚‹ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é–‹å§‹ã•ã‚Œã‚‹ã‚ˆã†èª¿æ•´ã™ã‚‹
    #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
  done
  # ãƒ«ãƒ¼ãƒ—çµ‚äº†å¾Œã®çµæœã‚‚tmp1_ltlbgtmpã«å‡ºåŠ›ã•ã‚Œã‚‹

  # ãƒ¢ãƒãƒ«ãƒ“å¯¾å¿œã€‚#######################################################
  # ãƒ¢ãƒãƒ«ãƒ“ã¯ã€ã“ã“ã¾ã§ã®å‡¦ç†ã§ã¯{ãƒ¢ãƒãƒ«ãƒ“ï½œã‚‚ã®ã‚‹ã³}ã§ã¯ãªã
  # {ãƒ¢ï½œã‚‚}{ãƒï½œã®}{ãƒ«ï½œã‚‹}{ãƒ“ï½œã³}ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã“ã‚Œã‚’å¾©æ—§ã™ã‚‹ã€‚
  # å…¥åŠ›ã¯tmp1_ltlbgtmpã®æƒ³å®šã€‚
  #######################################################################
  #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
  cat tmp1_ltlbgtmp >monorubyInput_ltlbgtmp 

  cat monorubyInput_ltlbgtmp \
  | grep -E -o '(\{[^ï½œ]+ï½œ[^}]+\}){2,}' \
  | uniq \
  | sed -e 's/\//\\\//g' \
  | sed -e 's/\[/\\\[/g' \
  | sed -e 's/\]/\\\]/g' \
  | sed -e 's/\^/\\\^/g' \
  | sed -e 's/\~/\\\~/g' \
  | sed -e 's/\*/\\\*/g' \
  | sed -e 's/\"/\\\"/g' \
  > tgt_ltlbgtmp

  if [ -s tgt_ltlbgtmp ]; then
    cat tgt_ltlbgtmp \
    | while read line || [ -n "${line}" ]; do \
        echo ${line} \
        | grep -E -o '\{[^ï½œ]+ï½œ' \
        | sed -e 's/^{//g' \
        | sed -e 's/ï½œ$//g' \
        | sed -z 's/\n//g' \
        | sed -e 's/^/\{/g' \
            | sed -e 's/\//\\\//g' \
            | sed -e 's/\[/\\\[/g' \
            | sed -e 's/\]/\\\]/g' \
            | sed -e 's/\^/\\\^/g' \
            | sed -e 's/\~/\\\~/g' \
            | sed -e 's/\*/\\\*/g' \
            | sed -e 's/\"/\\\"/g' \

        echo -n 'ï½œ'

        echo ${line} \
        | grep -E -o 'ï½œ[^}]+\}' \
        | sed -e 's/^ï½œ//g' \
        | sed -e 's/}$//g' \
        | sed -z 's/\n//g' \
        | sed -e 's/$/\}/g' \
            | sed -e 's/\//\\\//g' \
            | sed -e 's/\[/\\\[/g' \
            | sed -e 's/\]/\\\]/g' \
            | sed -e 's/\^/\\\^/g' \
            | sed -e 's/\~/\\\~/g' \
            | sed -e 's/\*/\\\*/g' \
            | sed -e 's/\"/\\\"/g' \

        echo ''
    done \
    > rep_ltlbgtmp

    paste -d '/' tgt_ltlbgtmp rep_ltlbgtmp \
    | sed -e 's/^/| sed -e '\''s\//g' \
    | sed -e 's/$/\/g'\'' \\/g' \
    | sed -z 's/^/cat monorubyInput_ltlbgtmp \\\n/g' \
    > tmp.sh
    bash tmp.sh >monorubyOutput_ltlbgtmp
  else 
    cat monorubyInput_ltlbgtmp >monorubyOutput_ltlbgtmp
  fi
  cat monorubyOutput_ltlbgtmp >tmp1_ltlbgtmp
  ########################ãƒ¢ãƒãƒ«ãƒ“å¯¾å¿œã“ã“ã¾ã§ã€‚å‡ºåŠ›ã¯tmp1_ltlbgtmp

  #åœç‚¹å¯¾å¿œ#################################################################################
  # åœç‚¹ã¯1å­—ãšã¤è¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã“ã“ã¾ã§ã®å‡¦ç†ã§ã¯
  # ã€Šãƒ¢ãƒãƒ«ãƒ“ã€‹ã§ã¯ãªãã€Šãƒ¢ã€‹ã€Šãƒã€‹ã€Šãƒ«ã€‹ã€Šãƒ«ãƒ“ã€‹ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã“ã‚Œã‚’å¾©æ—§ã™ã‚‹
  # å…¥åŠ›ã¯tmp1_ltlbgtmpã®æƒ³å®š
  ##########################################################################################
  #cat tmp2_ltlbgtmp >tmp1_ltlbgtmp
  cat tmp1_ltlbgtmp >emphasisInput_ltlbgtmp 
  cat emphasisInput_ltlbgtmp \
  | grep -E -o '(ã€Šã€Š[^ã€‹]+ã€‹ã€‹[ ã€€]?){2,}' \
  | uniq \
  >emphtmp_ltlbgtmp

  #ã€Šã€Šã€‹ã€‹ãŒé€£ç¶šã—ã¦ã„ã‚‹(è¤‡æ•°æ–‡å­—ã®åœç‚¹)ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°å®Ÿæ–½ã—ãªã„
  if [ -s emphtmp_ltlbgtmp ] ; then 
    cat emphtmp_ltlbgtmp \
    | sed -e 's/\//\\\//g' \
    | sed -e 's/\[/\\\[/g' \
    | sed -e 's/\]/\\\]/g' \
    | sed -e 's/\^/\\\^/g' \
    | sed -e 's/\~/\\\~/g' \
    | sed -e 's/\*/\\\*/g' \
    | sed -e 's/\"/\\\"/g' \
    | sed -e 's/^/| sed -e '\''s\//g' \
    >tgt_ltlbgtmp

    cat emphtmp_ltlbgtmp \
    | sed -e 's/[ã€Šã€‹]//g' \
    | sed -e 's/^/ã€Šã€Š/g' \
    | sed -e 's/$/ã€‹ã€‹/g' \
    | sed -e 's/$/\/g'\'' \\/g' \
    >rep_ltlbgtmp

    paste -d '/t' tgt_ltlbgtmp rep_ltlbgtmp \
    | sed -z 's/^/cat emphasisInput_ltlbgtmp \\\n/g' \
    >tmp.sh
    bash tmp.sh > emphasisOutput_ltlbgtmp
  else
    cat emphasisInput_ltlbgtmp >emphasisOutput_ltlbgtmp
  fi

  cat emphasisOutput_ltlbgtmp >tmp1_ltlbgtmp
  ########################åœç‚¹å¯¾å¿œã“ã“ã¾ã§ã€‚å‡ºåŠ›ã¯tmp1_ltlbgtmpã®æƒ³å®š

  cat tmp1_ltlbgtmp >${destFile}
  echo "âœ¨ "${destFile}"ã‚’å‡ºåŠ›ã—ã¾ã—ãŸ[txtã‚‚ã©ã—]"
fi

##########################################################################################
# ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸Šæ›¸ãã§ããªã„ãŸã‚ä½¿ç”¨ã—ã¦ã„ã‚‹ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚´ãƒŸæƒé™¤ã€‚ãªã‚“ã¨ã‹ãªã‚‰ã‚“ã‹â€¦
##########################################################################################
cd ../

if [ ! "${tmpDirName}" = '' ]; then 
  rm -rf ${tmpDirName}
fi
>>>>>>> c42a8a122b3e8c07e63fa9eaccb13d5d8d9cc7ad
exit 0
